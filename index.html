<html> 
     <header> 
         <link href='dark.css'/> 
         <link href='light.css'/> 
     </header> 
     <body> 
       
<li>浏览器自己都有 DNS 缓存机制，因此浏览器会先开始寻找自己的缓存，不过没有找到 <code>blog.skk.moe</code> 的解析结果</li>
<li>浏览器通过调用操作系统的 <code>getaddrinfo</code> 方法，向操作系统寻求解析结果</li>
<li>操作系统自己也有一层 DNS 缓存，但是现在操作系统从自己的缓存中依然找不到这一结果</li>
<li>在系统的网络设置之中有设置上游 DNS 地址，假设操作系统中设置的是 <code>119.29.29.29</code>，那么操作系统会向 <code>119.29.29.29</code> 发起解析请求（UDP 流量）拿到 <code>blog.skk.moe</code> 的 IP</li>
<li>当然如果 <code>119.29.29.29</code> 自己没有 <code>blog.skk.moe</code> 的解析结果会找它的上游去要。不过我们不关心这一点，反正最后 <code>119.29.29.29</code> 会把 <code>blog.skk.moe</code> 的解析结果返回给设备的操作系统</li>
<li>现在，浏览器已经可以开始向 <code>blog.skk.moe</code> 的 IP 发起 HTTPS 连接了</li>
</ol>
<p>以上是打开一个网页常见的 DNS 解析流程，对于其它非 HTTP 的 TCP 连接（比如 SMTP）也都差不多是这个流程——由于 TCP/IP 的协议特性，在应用发起 TCP 连接时，会先发出一个 DNS question（发一个 IP Packet），获取要连接的服务器的 IP 地址，然后直接向这个 IP 地址发起连接。</p><h2 id="She-Zhi-Dai-Li-Bing-Shi-Yong-Zhi-Lian">设置代理并使用直连</h2><p>现在，我们在应用程序（比如我们的浏览器、或者其它应用）中设置了代理，但是这个代理不涉及到任何远端服务器（直连模式）。接下来以设置了 SOCKS5 代理的浏览器为例。</p><ol>
<li>浏览器不再需要从自己的 DNS 缓存中寻找 <code>blog.skk.moe</code>，因为已经有了 SOCKS5 代理，浏览器可以直接将域名封装在 SOCKS5 流量之中发往代理客户端</li>
<li>代理客户端从 SOCKS5 流量中抽出 <code>blog.skk.moe</code> 这个域名并设法获得解析结果</li>
<li>代理客户端将你的 SOCKS5 流量还原成标准的 TCP 请求</li>
<li>代理客户端将这个 TCP 连接建立起来，在这个例子之中 TCP 连接承载的是 HTTPS</li>
</ol>
<p>之前由于获取解析结果是浏览器在操作，而大部分浏览器都会选择调用系统的 <code>getaddrinfo</code> 方法，因此如果你想要在 DNS 上做一些黑魔法就只能在操作系统层面实现，比如在本机或者别处架设一个带黑魔法的 DNS 服务器，然后你系统中设置使用这个 DNS 服务器。现在 DNS 解析是由代理客户端执行，因此在代理客户端上就可以实现一些黑魔法。比如 Surge 自己实现了一个 DNS Server 可以并发向多个上游同时发起查询、比如 V2Ray 可以实现不同域名的查询分流，等等。当然代理客户端也可以使用操作系统的 <code>getaddrinfo</code> 方法。</p><h2 id="She-Zhi-Dai-Li-Bing-Jiang-Liu-Liang-Zhuan-Fa-Dao-Yuan-Duan-Fu-Wu-Qi">设置代理并将流量转发到远端服务器</h2><p>现在在上一步的基础之上，我们为代理服务器设置了一个远端服务器，这个代理会使用 某种协议 和远端服务器通信，并且这种协议和 SOCKS5 一样支持将域名封装在传输中。浏览器和代理客户端之间依然使用 SOCKS5 通信。</p><ol>
<li>因为已经有了 SOCKS5 代理，浏览器可以直接将域名 <code>blog.skk.moe</code> 和整个请求封装在 SOCKS5 流量之中发往代理客户端</li>
<li>代理客户端从 SOCKS5 流量中抽出 <code>blog.skk.moe</code> 这个域名以及其它数据</li>
<li>代理客户端使用 某种协议 将浏览器发出的 SOCKS5 的流量重组并发给远端服务器</li>
<li>远端服务器使用相同的 某种协议 从流量中获得其中的域名 <code>blog.skk.moe</code></li>
<li>远端服务器的代理服务端发起了一次 DNS 解析请求试图解析 <code>blog.skk.moe</code>。绝大部分情况下，代理的服务端都会直接使用操作系统的 <code>getaddrinfo</code> 方法、也就是由远端服务器的操作系统负责 DNS</li>
</ol>
<p>这一次，不论是代理客户端还是你的浏览器都没有进行 DNS 解析，DNS 解析是在远端服务器上进行的。因为 某种协议 支持封装域名，然后这一次和 <code>blog.skk.moe</code> 连接的是远端服务器，考虑到针对 CDN 优化，DNS 解析自然需要在远端服务器上执行。</p><p>现在我已经介绍了通过代理直连和通过代理发送给远端服务器了。但是毫无疑问，我相信本文所有的读者自己使用的上网方式都不会是全面直连或者全面代理。这就是接下来要讲的：</p><h2 id="She-Zhi-Dai-Li-Bing-Shi-Yong-IP-Gui-Ze-He-Yu-Ming-Gui-Ze-Jin-Xing-Fen-Liu">设置代理并使用 IP 规则和域名规则进行分流</h2><p>分流是一个麻烦事。一般情况下，你可能会需要使用域名进行分流（不论是白名单还是黑名单）。不过更多情况下你会使用到基于 IP 的规则来进行分流。</p><p>先来看第一个例子：使用域名规则进行分流。</p><ol>
<li>浏览器将带有域名 <code>blog.skk.moe</code> 的 HTTPS 请求封装在 SOCKS5 流量之中发往代理客户端</li>
<li>代理客户端从 SOCKS5 流量中抽取出域名 <code>blog.skk.moe</code></li>
<li>代理客户端开始将<code>blog.skk.moe</code> 和域名规则列表开始比较。这个列表可以是白名单或黑名单，域名可能也没有匹配上。反正最终比较得出的结果就是 <code>blog.skk.moe</code> 是否需要走代理。</li>
<li>如果不需要走代理，代理客户端剩下会做的事情和本文第二部分「设置代理并使用直连」就完全一样了；同理，需要走代理的话就需要进行本文第三部分的那个流程</li>
</ol>
<p>使用域名规则分流很简单，除非 <code>blog.skk.moe</code> 最终是直连，否则代理客户端不需要进行 DNS 解析。</p><p>现在来看第二个例子：使用 IP 规则分流。</p><ol>
<li>浏览器将带有域名 <code>blog.skk.moe</code> 的 HTTPS 请求封装在 SOCKS5 流量之中发往代理客户端</li>
<li>代理客户端从 SOCKS5 流量中抽取出域名 <code>blog.skk.moe</code></li>
<li>代理客户端得到 <code>blog.skk.moe</code> 的解析结果</li>
<li>代理客户端开始将<code>blog.skk.moe</code> 的解析结果和 IP 规则列表开始比较。这个列表可以是 cnlist 或者 MaxMind IP 数据库。反正最终得出的结果就是 <code>blog.skk.moe</code> 解析结果的 IP 是否需要走代理。</li>
<li>如果不需要走代理，代理客户端剩下会做的事情和本文第二部分「设置代理并使用直连」就完全一样了；同理，需要走代理的话就需要进行本文第三部分的那个流程。</li>
</ol>
<p>使用 IP 规则分流，前提首先你得有一个 IP 拿来比较。所以代理客户端必须先进行一次 DNS 解析。使用什么方法进行 DNS 解析并不重要，之前已经说过代理客户端甚至可以使用自己的黑魔法，而我们只需要关心最终代理客户端拿到了一个 IP 并且可以用于规则判定。</p><p>此时需要注意的是，虽然代理客户端获得了一个 IP，但是你只有在直连的时候，代理客户端可能（并且基本上都会）复用这个 IP；如果是将流量交给远程服务器，由于 某种协议 支持封装域名，因此远程服务器拿到的还是域名不是 IP、还需要进行一次解析。也就是说，远端服务器连接的 IP 与 代理客户端解析得到的 IP 毫无关系。</p><h2 id="Shi-Yong-redir-x2F-tun2socks-Shi-Xian-Quan-Ju-Liu-Liang-Jing-Guo-Dai-Li">使用 redir / tun2socks 实现全局流量经过代理</h2><p>在开始之前，我们先复习一下 TCP/IP 协议怎么说的——「在应用发起 TCP 连接时，会先发出一个 DNS question（发一个 IP Packet），获取要连接的服务器的 IP 地址，然后直接向这个 IP 地址发起连接」</p><p>全局流量代理可能会出现在路由器上或者 TUN/TAP 型的支持全局代理客户端上。用户不再主动为每个应用程序设置代理。此时应用程序是不会感知到代理客户端的存在，它们会正常的发起 TCP 连接，并且由于 TCP/IP 协议，在拿到 DNS 解析结果之前，连接是不能建立的。</p><ol>
<li>浏览器自己都有 DNS 缓存机制，因此浏览器会先开始寻找自己的缓存，不过没有找到 <code>blog.skk.moe</code> 的解析结果</li>
<li>浏览器通过调用操作系统的 <code>getaddrinfo</code> 方法，向操作系统寻求解析结果</li>
<li>操作系统自己也有一层 DNS 缓存，但是现在操作系统从自己的缓存中依然找不到这一结果</li>
<li>在系统的网络设置之中有设置上游 DNS 地址。代理客户端可能会修改系统设置中的 DNS 到 127.0.0.1 或者别的 IP、也可能保留用户之前的设置，这无所谓，因为...</li>
<li>操作系统发出的 DNS 解析请求会经过代理客户端并最终被截获</li>
<li>代理客户端可以将这个解析请求原样发出去、或者用自己的黑魔法，总之代理客户端都会拿到一个解析结果</li>
<li>代理客户端将这个解析结果返回回去，操作系统拿到了这个解析结果并返回给浏览器</li>
<li>浏览器对这个解析结果的 IP 建立一个 TCP 连接并发送出去</li>
<li>这个 TCP 连接被代理客户端截获。由于之前代理客户端进行的 DNS 解析请求这一动作，代理客户端可以找到这个只包含目标 IP 的 TCP 连接原来的目标域名</li>
<li>如果是支持 redir 的代理客户端，那么代理客户端就会直接将域名和 TCP 连接中的其它数据封装成 某种协议 发给远端服务器；或者封装成 SOCKS5 后交给支持 SOCKS5 的代理客户端</li>
</ol>
<p>如果代理客户端需要按照域名进行分流，一般会在第 6 步代理客户端解析出一个 IP 或者第 9 步代理客户端拿到域名以后。FancySS、KoolSS、SSTap 的流程大抵都是如此。</p><p>和应用程序直接将流量封装成 SOCKS5 大有不同，在类似于透明代理的环境下浏览器和其它应用程序是正常地发起 TCP 连接。因此除非得到一个 DNS 解析结果，否则 TCP 连接不会建立；代理客户端也会需要通过这个 DNS 查询动作，才能找到之后的 TCP 连接的域名。<br/>你大概能够发现，浏览器、应用程序直接设置 SOCKS5 代理的话，可以不在代理客户端发起 DNS 解析请求就能将流量发送给远端服务器；而在透明代理模式下，不论是否需要 IP 规则分流都需要先进行一次 DNS 解析才能建立连接。</p><p>有没有办法能像直接设置 SOCKS5 代理一样省掉一次 DNS 解析呢？有，就是代理客户端自己不先执行查询动作，丢一个 Fake IP 回去让浏览器、应用程序立刻建立 TCP 连接：</p><h2 id="Zai-redir-x2F-tun2socks-Zhong-Shi-Yong-Fake-IP">在 redir / tun2socks 中使用 Fake IP</h2><p>Fake IP 的定义出自 <a href="https://tools.ietf.org/rfc/rfc3089" target="_blank" rel="noopener noreferrer external nofollow">RFC3089</a>。这个 RFC 定义了一种新的将 TCP 连接封装成 SOCKS 协议的方法。</p><ol>
<li>浏览器自己都有 DNS 缓存机制，因此浏览器会先开始寻找自己的缓存，不过并没有找到 <code>blog.skk.moe</code> 的解析结果</li>
<li>浏览器通过调用操作系统的 <code>getaddrinfo</code> 方法，向操作系统寻求解析结果</li>
<li>操作系统自己也有一层 DNS 缓存，但是现在操作系统从自己的缓存中依然找不到这一结果</li>
<li>在系统的网络设置之中设置了一个专门的上游 DNS 地址，可能是用户手动设置的也可能是代理客户端设置的。不论如何，这个设置最终会使操作系统向代理客户端发起 DNS 请求</li>
<li>操作系统发出的 DNS 解析请求会经过代理客户端并最终被截获</li>
<li>代理客户端从解析请求中获得域名，从 Fake IP 池中选取一个 IP 建立映射</li>
<li>代理客户端将这个 Fake IP 返回回去，操作系统拿到了这个 Fake IP 并返回给浏览器</li>
<li>浏览器对 Fake IP 建立一个 TCP 连接并发送出去</li>
<li>这个 TCP 连接被代理客户端截获。代理客户端抽取出 Fake IP 并反查出这个 TCP 连接中对应的域名</li>
<li>有了 TCP 连接和域名，代理客户端可以轻易地将其使用 SOSCKS5 或者 某种协议 进行封装</li>
</ol>
<p>有了 Fake IP，代理客户端无需进行 DNS 解析。最后不论是浏览器、代理客户端还是远端服务器都不会去和 Fake IP 进行连接，因为在代理客户端这里就已经完成了截获、重新封装。</p><p>即使按照域名规则分流，代理客户端都没有进行 DNS 解析的需要。只有在遇到了按照 IP 进行分流的规则时，代理客户端才需要进行一次解析拿到一个 IP 用于判断。即便如此，这个 IP 只用于分流规则的匹配，不会被用于实际的连接。</p><h2 id="FancySS-He-Surge-x2F-Clash-De-Qu-Bie">FancySS 和 Surge / Clash 的区别</h2><p>FancySS 是使用的 redir，Surge 的增强模式使用的是 Fake IP，Clash 的增强模式既有 redir-host 也有 Fake IP。首先把 FancySS 等路由器上常见的代理客户端和 Clash 的 redir-host 分为一类，Surge 的增强模式和 Clash 的 fake-ip 模式分为另一类。</p><p>路由器上常见的代理客户端一般内置了 dns2socks、dnscryp-proxy、PCap_DNSProxy 等等 DNS 方案、也支持按照一定的规则进行分流，但是都是用于答复应用程序的 DNS question 使其建立 TCP 连接的，除非直连，否则通过这些 DNS 方案拿到的解析结果的 IP 并不会被用上。<br/>大部分路由器上的代理客户端，DNS 解析请求都是通过路由器本机发出（或转发到单一远端服务器进行解析），因此解析结果只能说「至少能用」（不一定是有 CDN 优化的，甚至有可能会有 DNS 污染），如果流量不经过代理客户端直接发往这些 IP 地址，一般也不会影响浏览器、应用程序的正常使用。因此路由器上的代理客户端可以实现通过 iptables 控制让某些端口、某些设备的流量不经过代理客户端。<br/>而在 Fake IP 模式下，浏览器、应用程序都是对 Fake IP 发起连接，如果没有代理客户端对连接进行重新封转，那么这部分流量就不能被发往真实的目的 IP，因此所有流量都必须经过代理客户端，而根据端口、设备的分流就需要由代理客户端自己实现。</p><h2 id="Ru-Guo-Cao-Zuo-Xi-Tong-Huo-Zhe-Liu-Lan-Qi-Huan-Cun-Liao-DNS-Jie-Xi-Jie-Guo">如果操作系统或者浏览器缓存了 DNS 解析结果</h2><p>之前的透明代理的两个例子中，我们都假定浏览器和操作系统都没有缓存 DNS 解析结果。但是，如果操作系统或者应用程序缓存了 DNS 解析结果会发生什么？</p><p>如果是不使用 Fake IP 的 redir / tun2socks 情况下，由于操作系统、浏览器或者应用程序中的任何一个缓存了 DNS 解析结果，因此 TCP 连接可以直接根据缓存的解析结果的 IP 建立，代理客户端并没有预先收到对应的 DNS question。在这种情况下，代理客户端有可能直接将这个连接视为和 IP 连接而不是和域名连接，根据域名规则的分流可能就会因此失效，不过根据 IP 分流的规则没有失效。<br/>如果为了避免域名分流规则失效，你可以设法阻止操作系统或者浏览器缓存 DNS 解析结果，这样每次建立 TCP 连接之前都会发送 DNS question 使代理客户端探测到域名。但是这意味着每次 TCP 连接建立都需要代理客户端进行一次 DNS 解析请求（当然代理客户端可以对 DNS 解析进行缓存避免出现延时激增）。</p><p>而对于 Fake IP 模式来说，由于代理客户端内存储有 Fake IP 和真实域名之间的映射表，因此即使操作系统或应用程序缓存了 Fake IP，在之后的 TCP 连接中，代理客户端收到流量后依然可以抽取出 Fake IP 反查出域名，因此不受 DNS 缓存的影响。</p><p>我在这里留几个问题给大家思考一下：</p><ul>
<li>如果使用了 Fake IP，代理客户端不论域名是否真实存在都会返回一个 Fake IP 给浏览器，那么浏览器在试图访问一个不存在的域名时，错误信息应该是什么样的？会不会出现 DNS 解析失败的错误信息？</li>
<li>如果操作系统或者浏览器缓存了 Fake IP，但是代理客户端中 Fake IP 和域名的映射表丢失以后，会出现什么状况？可能会出现什么错误信息？</li>
</ul>
<p>第二个问题很有趣。因为如果你找到了第二个问题的答案，你就会意识到 Clash 在 Fake IP 模式下偶发的无法上网的原因了。</p><h2 id="Can-Kao-Zi-Liao-2">参考资料</h2><ul>
<li><a href="https://imququ.com/post/web-proxy.html" target="_blank" rel="noopener noreferrer external nofollow">HTTP 代理原理及实现（一）</a> - 我的文章中举得都是 SOCKS5 的例子，如果想了解一下在 HTTP 代理中流量是如何被封装的，可以看看屈屈的这篇博客</li>
<li><a href="https://medium.com/@Blankwonder/surge-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-8aa3304fb3bb" target="_blank" rel="noopener noreferrer external nofollow">Surge 原理与实现</a> - Surge 开发者写的 Surge 早期版本的工作原理，可以了解一下 Surge 是怎么处理各种协议的流量的</li>
<li><a href="https://medium.com/@TachyonDevel/%E6%BC%AB%E8%B0%88%E5%90%84%E7%A7%8D%E9%BB%91%E7%A7%91%E6%8A%80%E5%BC%8F-dns-%E6%8A%80%E6%9C%AF%E5%9C%A8%E4%BB%A3%E7%90%86%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8-62c50e58cbd0" target="_blank" rel="noopener noreferrer external nofollow">漫谈各种黑科技式 DNS 技术在代理环境中的应用</a> - Kitsunebi 开发者写的文章，详细地介绍了在不同的 V2Ray 配置下的 DNS 行为，同时还有对移动端网络栈的一些介绍</li>
</ul>
</section><div class="dwPPpV cjScYX kQBRAp bTNDYw ffGozt gZtkYs dUvWpK hRLVFh gXlVLa diLtXU Vabsy cTVtxN "><div class="jTjNVR iKck dIRDTl bmFLeF ">浅谈在代理环境中的 DNS 解析行为</div><div class="hyjQvk diNRrl kZxEXA "><a class="bEAqvP dLUwcr " href="https://blog.skk.moe/post/what-happend-to-dns-in-proxy/">https://blog.skk.moe/post/what-happend-to-dns-in-proxy/</a></div><div class="gSBWlu foGVKH fPWmiY kiDYix "><div class="jTjNVR jmCeQl dJntus bmFLeF "><div class="jTjNVR iKck dIRDTl bmFLeF diNRrl ">本文作者</div><div class="jTjNVR iKck hNjeNG bmFLeF ">Sukka</div></div><div class="jTjNVR jmCeQl dJntus bmFLeF "><div class="jTjNVR iKck dIRDTl bmFLeF diNRrl ">发布于</div><div class="jTjNVR iKck hNjeNG bmFLeF ">2019-07-22</div></div><div class="jTjNVR jmCeQl dJntus bmFLeF "><div class="jTjNVR iKck dIRDTl bmFLeF diNRrl ">许可协议</div><div class="jTjNVR iKck hNjeNG bmFLeF "><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noreferrer" class="bEAqvP dLUwcr ">CC BY-NC-SA 4.0</a></div></div></div><div>转载或引用本文时请遵守许可协议，注明出处、不得用于商业用途！</div><i class="ycSPk iknnvS bWydik cpOcAb kKDTSU emVtrI dwPPpV bEvNbr fygwnR bLHLvQ ecjlX hvmOHQ ouiRd julXB dhOkuk kvHVCE jmTvKz dResSS jVKJhP qOQRo ftrJDm dnkCBy cDbpcH kZwOdx kSnqYR fgiDpI eeAUEW bnSwfb cOQHkb bVHlsq cKWmox jZLyOQ bUxwiT hQJXjP fqXcHQ haKUHj dyMCpl kevfEr hyOZDn fSuxSX mupLC kvABFJ diZuuN gaNphp fdFwfp eGyfkC hhBXzE iyXZtO hZGkn icYpyF jkOwii jXmaZg joeSnw clJfeA kimLBn iHrpsk fPwJri eZZAwM ktIykT FwRrA cDIyHz hpBjJb dZDNG bynUJ ialQbk"></i></div><footer class="gSBWlu kiDYix fPWmiY kWUGWQ diLtXU gxEkDX cTVtxN cVRxWB dXWgbR "><a class="fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk hNyMbp guWNSJ ddysuV gOjCJU cduofK SNIUj eMVBWN " href="/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"># <!-- -->技术向</a><a rel="tag" class="fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet " href="/tags/DNS/"># <!-- -->DNS</a><a rel="tag" class="fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet " href="/tags/Surge/"># <!-- -->Surge</a><a rel="tag" class="fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet " href="/tags/Clash/"># <!-- -->Clash</a><a rel="tag" class="fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet " href="/tags/Fake-IP/"># <!-- -->Fake IP</a><a rel="tag" class="fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet " href="/tags/SOCKS5/"># <!-- -->SOCKS5</a></footer></article><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN kooHYa"><div class="diNRrl hyjQvk bBVwIW ">喜欢这篇文章？为什么不打赏一下作者呢？</div><a href="https://afdian.net/@sukka" target="_blank" rel="noopener nofollow noreferrer" class="kcJmwb itAGJL HhHXE bmPsOO foGVKH jhKQav dwPPpV fYpehW hJqMHb fygwnR cirhiC lexxaO izjaRz irHqxI ka_DAXd feZCbt larHMv jmZMAS ">爱发电</a></div><nav class="gSBWlu hsxujn iKck dZuvvJ bmFLeF dugTDd " role="navigation"><div class="gSBWlu dQPgRK eKlQYW bLlOeF fPWmiY hmKFEM "><a class="gSBWlu dugTDd foGVKH hqSOEl kVZHcH cbEMfi iATxZH liVmWr bbUXPo " href="/post/how-koolclash-worked/"><i class="epEjwu cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ ecjlX bsEZrB cFxYsm julXB dhOkuk kvHVCE hCTuXM cqyuit ibSSyM cODSMr kSnqYR fgiDpI eeAUEW gjJuRC iWYpgm jbzBdl fqXcHQ haKUHj dyMCpl kevfEr dXSlMo hIrAsl"></i><div class="jxySid kKRHCo bTNDYw epEjwu ">KoolClash 的工作机制</div></a></div><div class="gSBWlu dQPgRK eKlQYW bLlOeF fXzCvR klEWBS "><a class="gSBWlu dugTDd foGVKH hqSOEl kVZHcH cbEMfi iATxZH liVmWr bbUXPo " href="/post/how-regex-caused-cf-global-502/"><div class="jxySid kKRHCo bTNDYw epEjwu ">[翻译] Cloudflare 在 2019 年 7 月 2 日宕机的技术细节</div><i class="epEjwu cpOcAb hHGIsI jXmXEB kKRHCo cjScYX fygwnR bLHLvQ ecjlX bTanCN cFxYsm julXB dhOkuk kvHVCE hCTuXM cqyuit iEAnTV kfcRAM kSnqYR fgiDpI eeAUEW jTqZiD iWYpgm bblCYQ fqXcHQ haKUHj dyMCpl kevfEr dXSlMo fsWlQg"></i></a></div></nav><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN"><div class="dvsTCO "><!--$--><div class="kooHYa kWUGWQ dwawJR eonfmG jQenOz cDWHSV iKck ecxexf bmFLeF eCuFxb ">评论加载中...</div><!--/$--></div></div></div><aside class="kQBRAp jNLCbB lnHxHM bkSasJ eBzqiJ "><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN kooHYa"><div class="jIJzLC eYbNXG jTjNVR jdraHW hyjQvk eqrBPF clJfeA kimLBn iHrpsk fPwJri "><picture><source type="image/webp" srcSet="https://img10.360buyimg.com/ddimg/jfs/t1/214940/28/13992/13695/622039e0E8283ea56/6176b9c35f4d60ab.webp"/><img class="jIJzLC eYbNXG clJfeA kimLBn iHrpsk fPwJri " width="96" height="96" alt="Sukka&#x27;s Avatar" src="https://img10.360buyimg.com/ddimg/jfs/t1/214940/28/13992/13695/622039e0E8283ea56/6176b9c35f4d60ab.png" decoding="async" loading="lazy"/></picture></div><h2 class="kiMAEz buowod rXoKk dIAaBe hyjQvk ctpWtp">Sukka</h2><div class="hyjQvk ">童话只美在真实却从不续写</div><a class="fcXWHl " rel="me" href="https://acg.mn/@sukka"></a><div class="gSBWlu kJzccJ "><div class="jTjNVR gPtJog hNjeNG PSfXk dQPgRK bUPwGt iBlkxz "><div class="jfXcDa dIAaBe ">101</div><div class="jfXcDa kKRHCo ">文章</div></div><div class="jTjNVR gPtJog hNjeNG PSfXk dQPgRK bUPwGt iBlkxz "><div class="jfXcDa dIAaBe ">6</div><div class="jfXcDa kKRHCo ">分类</div></div><div class="jTjNVR gPtJog hNjeNG PSfXk dQPgRK bUPwGt iBlkxz "><div class="jfXcDa dIAaBe ">186</div><div class="jfXcDa kKRHCo ">标签</div></div><div class="jTjNVR gPtJog hNjeNG PSfXk dQPgRK bUPwGt iBlkxz "><div class="jfXcDa dIAaBe ">29.5</div><div class="jfXcDa kKRHCo ">万字</div></div></div></div><div class="kiysLX hBBXbq "><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN efXXGu dKiLhc fBsfva bUghBy jDlogQ ljZRGO hUkKDO OluFl lkLVGh lcfxiY bYDdpL buREsn kYIcLL eednKS gVbVXo jnvyJO dxhWkM hOttdb eMigyT gyjuWy iXsGkK fNXYAQ"><div class="epEjwu diNRrl bBVwIW hyjQvk ">文章目录</div><ul class=""><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#Bu-Shi-Yong-Dai-Li" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">不使用代理</a></li><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#She-Zhi-Dai-Li-Bing-Shi-Yong-Zhi-Lian" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">设置代理并使用直连</a></li><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#She-Zhi-Dai-Li-Bing-Jiang-Liu-Liang-Zhuan-Fa-Dao-Yuan-Duan-Fu-Wu-Qi" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">设置代理并将流量转发到远端服务器</a></li><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#She-Zhi-Dai-Li-Bing-Shi-Yong-IP-Gui-Ze-He-Yu-Ming-Gui-Ze-Jin-Xing-Fen-Liu" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">设置代理并使用 IP 规则和域名规则进行分流</a></li><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#Shi-Yong-redir-x2F-tun2socks-Shi-Xian-Quan-Ju-Liu-Liang-Jing-Guo-Dai-Li" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">使用 redir / tun2socks 实现全局流量经过代理</a></li><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#Zai-redir-x2F-tun2socks-Zhong-Shi-Yong-Fake-IP" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">在 redir / tun2socks 中使用 Fake IP</a></li><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#FancySS-He-Surge-x2F-Clash-De-Qu-Bie" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">FancySS 和 Surge / Clash 的区别</a></li><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#Ru-Guo-Cao-Zuo-Xi-Tong-Huo-Zhe-Liu-Lan-Qi-Huan-Cun-Liao-DNS-Jie-Xi-Jie-Guo" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">如果操作系统或者浏览器缓存了 DNS 解析结果</a></li><li class="jTjNVR iKck hNjeNG bmFLeF "><a href="#Can-Kao-Zi-Liao-2" class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN">参考资料</a></li></ul></div><div class="kQBRAp bfssAU "><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN"><div class="epEjwu diNRrl bBVwIW hyjQvk ">相关文章</div><div class="kKplrA "><time class="diNRrl ">2019-08-02</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/how-koolclash-worked/">KoolClash 的工作机制</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2018-08-25</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/aliyun-vipdns-anycast/">阿里云 BGP Anycast 路由</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2019-05-09</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/macos-vmware-surge-gateway/">使用 VMware 安装 macOS 虚拟机使用 Surge 作为代理网关</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2018-09-08</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/about-cname-and-mx-conflicts/">也来谈谈关于 CNAME 和 MX 冲突的一些事</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2019-05-13</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/alternate-surge-koolclash-as-gateway/">代替 Surge 增强模式——使用 KoolClash 作为代理网关</a></div></div><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN"><div class="epEjwu diNRrl bBVwIW hyjQvk ">最近文章</div><div class="kKplrA "><time class="diNRrl ">2024-01-04</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/2023-browser-from-a-to-z/">2023：浏览器从 A 到 Z</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2023-06-25</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/refactor-my-blog-using-nextjs-app-router/">React Server Component 初体验与实践 —— 将博客迁移到 Next.js App Router</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2023-01-15</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/say-no-to-meta-keywords/">Meta Keywords：是什么、为什么不</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2023-01-12</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/2022-browser-from-a-to-z/">2022：浏览器从 A 到 Z</a></div></div></div><div class=""><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN"><div class="epEjwu diNRrl bBVwIW hyjQvk ">分类</div><a class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN" href="/categories/%E6%8A%80%E6%9C%AF%E5%90%91/">技术向<span class="dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf ">35</span></a><a class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN" href="/categories/%E7%AC%94%E8%AE%B0%E6%9C%AC/">笔记本<span class="dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf ">33</span></a><a class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN" href="/categories/%E5%88%9B%E4%BD%9C%E9%9B%86/">创作集<span class="dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf ">9</span></a><a class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN" href="/categories/%E8%87%AA%E8%A8%80%E8%AF%AD/">自言语<span class="dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf ">10</span></a><a class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN" href="/categories/%E5%88%86%E4%BA%AB%E5%A2%83/">分享境<span class="dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf ">3</span></a><a class="joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN" href="/categories/%E9%BB%91%E8%8B%B9%E6%9E%9C/">黑苹果<span class="dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf ">10</span></a></div><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN"><div class="epEjwu diNRrl bBVwIW hyjQvk ">热门标签</div><div class="gSBWlu kiDYix fPWmiY ipqqbv "><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/macOS/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->macOS</span></a><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/JavaScript/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->JavaScript</span></a><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/DNS/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->DNS</span></a><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/Hexo/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->Hexo</span></a><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->前端性能优化</span></a><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/Hackintosh/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->Hackintosh</span></a><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/CDN/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->CDN</span></a><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/OpenWrt/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->OpenWrt</span></a><a class="kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk " href="/tags/Cloudflare/"><span class="hNyMbp iANrEZ eOUwza bGTDx kGbpDY "># <!-- -->Cloudflare</span></a></div></div></div></div></aside><aside class="fcXWHl gGHVHy lnHxHM gmUhDS "><div class="evLKHN bCLaAs "><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN"><div class="epEjwu diNRrl bBVwIW hyjQvk ">相关文章</div><div class="kKplrA "><time class="diNRrl ">2019-08-02</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/how-koolclash-worked/">KoolClash 的工作机制</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2018-08-25</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/aliyun-vipdns-anycast/">阿里云 BGP Anycast 路由</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2019-05-09</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/macos-vmware-surge-gateway/">使用 VMware 安装 macOS 虚拟机使用 Surge 作为代理网关</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2018-09-08</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/about-cname-and-mx-conflicts/">也来谈谈关于 CNAME 和 MX 冲突的一些事</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2019-05-13</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/alternate-surge-koolclash-as-gateway/">代替 Surge 增强模式——使用 KoolClash 作为代理网关</a></div></div><div class="dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN"><div class="epEjwu diNRrl bBVwIW hyjQvk ">最近文章</div><div class="kKplrA "><time class="diNRrl ">2024-01-04</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/2023-browser-from-a-to-z/">2023：浏览器从 A 到 Z</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2023-06-25</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/refactor-my-blog-using-nextjs-app-router/">React Server Component 初体验与实践 —— 将博客迁移到 Next.js App Router</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2023-01-15</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/say-no-to-meta-keywords/">Meta Keywords：是什么、为什么不</a></div><div class="kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY "><time class="diNRrl ">2023-01-12</time><br/><a class="kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY " href="/post/2022-browser-from-a-to-z/">2022：浏览器从 A 到 Z</a></div></div></div></aside><div class="imhmwA eSaSrN kYCSJu dgroLK jqaXfP cQYyqP kSWQpF "><a role="button" aria-label="文章目录" class="foGVKH jcakPO diNRrl edlReQ kQBRAp fYTIfM izjaRz irHqxI ka_DAXd feZCbt egGyMq joyWtj jsvbrX kOZVYa jxdZaJ hacnay huVdIn larHMv jGAsBS fvWVzw cRisAQ eRJcWQ dDzUXW "><i class="cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ cFxYsm julXB dhOkuk kvHVCE hCTuXM cqyuit cOyzyd kSnqYR bQvqKh iqzSxf fqXcHQ haKUHj dyMCpl kevfEr dXSlMo"></i></a><a href="#" title="top" aria-label="回到顶部" class="foGVKH jcakPO diNRrl edlReQ kQBRAp fYTIfM izjaRz irHqxI ka_DAXd feZCbt egGyMq joyWtj jsvbrX kOZVYa jxdZaJ hacnay huVdIn larHMv jGAsBS fvWVzw cRisAQ eRJcWQ "><i class="cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ ecjlX bsEZrB cFxYsm julXB dhOkuk kvHVCE hCTuXM cqyuit iEAnTV kfcRAM kSnqYR fgiDpI eeAUEW gjJuRC iWYpgm jbBqfU fqXcHQ haKUHj dyMCpl kevfEr dXSlMo"></i></a></div><script type="application/ld+json">[{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/","url":"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/","articleSection":"技术向","author":{"@type":"Person","name":"Sukka","url":"https://skk.moe","sameAs":["https://github.com/SukkaW","https://twitter.com/isukkaw","https://t.me/sukkachannel","https://keybase.io/sukka","https://acg.mn/@sukka"]},"headline":"浅谈在代理环境中的 DNS 解析行为","name":"浅谈在代理环境中的 DNS 解析行为","abstract":"虽然 Fake IP 这个概念早在 2001 年就被提出来了，但是到 Clash 提供 fake-ip 增强模式以后，依然有很多人对 Fake IP 这个概念以及其作用知之甚少。本文就简单谈谈在代理环境中，TCP 连接建立之前发生的事。由于移动设备操作系统中网络栈相对复杂，本文的例子也并不一定适用于移动端环境。文章中也许会存在很多错误，也希望各路大佬的勘误和斧正。","discussionUrl":"https://blog.skk.moe/post/what-happend-to-dns-in-proxy#disqus_thread","dateCreated":"2019-07-22T09:13:00.000Z","datePublished":"2019-07-22T09:13:00.000Z","dateModified":"2019-07-22T09:13:00.000Z","thumbnailUrl":"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png","keywords":"DNS, Surge, Clash, Fake IP, SOCKS5","image":[{"@type":"ImageObject","url":"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png","uploadDate":"2019-07-22T09:13:00.000Z"},{"@type":"ImageObject","url":"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png.webp","uploadDate":"2019-07-22T09:13:00.000Z"}]},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://blog.skk.moe/archives/"},{"@type":"ListItem","position":2,"name":"技术向","item":"https://blog.skk.moe/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"@type":"ListItem","position":3,"name":"浅谈在代理环境中的 DNS 解析行为"}]}]</script></div><footer class="kooHYa evdPrE diLtXU eoqbKT cTVtxN iZcyKt jXUIWe epEjwu kKplrA "><div class="iGDTOy jTjNVR jdraHW hNjeNG eqrBPF iAfHVR jZdtRd cGCNzc eIBfQn kKkndf"><div>Copyright © 2018 - <span>2023</span> <a class="hNyMbp " href="/">Sukka&#x27;s Blog</a></div><div>Powered by<!-- --> <a target="_blank" rel="noopener nofollow noreferrer" href="https://hexo.io/" class="hNyMbp ">Hexo</a> &amp; <a target="_blank" rel="noopener nofollow noreferrer" href="https://nextjs.org/" class="hNyMbp ">Next.js</a><span class="jTjNVR hIrAsl hNjeNG dDVQEX gKQCBv "></span>Designed by<!-- --> <a target="_blank" rel="noopener nofollow noreferrer" href="https://skk.moe" class="hNyMbp ">Sukka</a></div></div></footer><script src="/_next/static/chunks/webpack-204ecff32a090efe.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/77ddf75ae24c4cf9.css\",\"style\",{\"crossOrigin\":\"\"}]\n2:HL[\"/_next/static/css/1b4a8388d1ebea78.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/d9fb349f3ded94d2.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7278,[],\"\"]\n9:I[4468,[],\"\"]\na:I[2361,[],\"\"]\nc:I[6827,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"185\",\"static/chunks/app/layout-15e7c6c7e99aa358.js\"],\"ToCVisibilityProvider\"]\nd:I[5293,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"185\",\"static/chunks/app/layout-15e7c6c7e99aa358.js\"],\"DarkModeProvider\"]\ne:I[1697,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"385\",\"static/chunks/385-81234ac0c2374888.js\",\"609\",\"static/chunks/app/post/%5Bslug%5D/layout-62df7fa213f3ef72.js\"],\"\"]\n10:I[3087,[\"697\",\"stati"])</script><script>self.__next_f.push([1,"c/chunks/697-c8d30c5edb9941df.js\",\"185\",\"static/chunks/app/layout-15e7c6c7e99aa358.js\"],\"\"]\n11:I[7093,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"601\",\"static/chunks/app/error-5ccb2c4a45c95454.js\"],\"\"]\n12:I[7608,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"185\",\"static/chunks/app/layout-15e7c6c7e99aa358.js\"],\"ClientEffect\"]\n13:I[4492,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"185\",\"static/chunks/app/layout-15e7c6c7e99aa358.js\"],\"\"]\n15:I[2366,[],\"\"]\nb:HC[\"https://img10.360buyimg.com\",\"\"]\nf:T4d3,"])</script><script>self.__next_f.push([1,"M437 2a466 466 0 1061 930A466 466 0 00437 2zm234 169a401 401 0 01-1 119l8 16c17 41 18 47 18 85 0 26-1 43-4 53-1 6-6 11-13 15-8 5-7 6 6 6 25 0 46 4 62 12 13 7 21 13 33 26 11 11 14 17 14 23-1 5-8 24-13 31a51 51 0 01-19 19l27 28c30 30 38 39 53 60 8 12 17 28 17 33a400 400 0 01-75 96 1051 1051 0 01-112-176l-4 4a161 161 0 01-66 64c-9 4-11 6-11 8l-1 4c-2 1-5 15-4 16l18 8 24 2 19 1 9 4c15 8 21 16 33 47 6 14 25 73 25 76s-31 21-54 32a451 451 0 01-412-14c-2-1-2-2 2-13a384 384 0 0142-82c20-28 25-31 41-34l11-3 15-6c20-6 31-13 33-20 1-5-1-19-4-29-2-8-2-10-1-13 1-4 1-4 4-4l4-1-7-12c-7-13-8-17-6-23 1-3 1-3 7-4 11-2 12-4 10-14-2-6-13-16-23-21-7-4-9-4-9-1l-19 38-14 13-11 10-3-3c-3-2-6-3-9-1-1 1-2 3-2 15-2 23-4 34-12 46-11 19-38 40-114 92l-16 11-8-7c-8-7-30-30-30-32a1167 1167 0 0163-100c-2 0-28 28-50 54l-25 29 41-60c15-21 22-28 37-38l14-9-4-7c-9-12-5-17 33-49 9-7 16-14 16-15l2-6c3-5 3-10 1-12l-10-1c-5-1-7-2-7-3l-4-15c-4-19-5-33-2-54 3-17 5-24 8-26 4-2 20 5 22 9l2 1-4-18c-8-29-9-38-6-69v-20a180 180 0 00-18 51l3-37c5-22 15-51 19-55 1-1 1-2-4-12-7-13-11-25-14-41a709 709 0 01-7-90v-10h8c24 2 49 14 79 38l11 8c1 1 4 0 13-7 27-19 58-35 82-40 6-2 7-2 30 1 28 4 30 4 30 1 0-1-2-3-6-5l-6-3h9a222 222 0 0189 33l11-7c22-14 53-27 76-34l7-2 1 6 2 14z"])</script><script>self.__next_f.push([1,"16:[]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/77ddf75ae24c4cf9.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/1b4a8388d1ebea78.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"Z6LMoirPwoXOmyQVvEv8i\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/what-happend-to-dns-in-proxy/\",\"initialTree\":[\"\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"what-happend-to-dns-in-proxy\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"what-happend-to-dns-in-proxy\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"what-happend-to-dns-in-proxy\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[null,\"$L8\",null]]},[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"zh-Hans\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#fff\"}],[\"$\",\"link\",null,{\"rel\":\"sitemap\",\"type\":\"application/xml\",\"title\":\"Sukka's Blog Site Map\",\"href\":\"https://blog.skk.moe/sitemap.xml\"}],[\"$\",\"link\",null,{\"rel\":\"search\",\"type\":\"application/opensearchdescription+xml\",\"href\":\"/os.xml\",\"title\":\"Sukka's Blog\"}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"((e,t,c)=\u003e{try{let o=localStorage[\\\"user-color-scheme\\\"];o\u0026\u0026e.documentElement.classList.add(o),e.querySelectorAll('meta[name=\\\"theme-color\\\"]').forEach(e=\u003ee.setAttribute(\\\"content\\\",o?\\\"dark\\\"===o?t:c:window.matchMedia(\\\"(prefers-color-scheme: dark)\\\").matches?t:c))}catch(e){}})(document,\\\"#364151\\\",\\\"#fff\\\");\"}}],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$Ld\",null,{\"children\":[[\"$\",\"nav\",null,{\"className\":\"jXUIWe iZcyKt eSaSrN bJbGbF jqaXfP cjScYX cCmETV bruQos eGSTyt boTDVe \",\"role\":\"navigation\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"className\":\"XEVlt IVbXa jYEAGD gSBWlu hriXhD fUkzcN eeaCeL \",\"children\":[\"$\",\"$Le\",null,{\"children\":[[\"$\",\"svg\",null,{\"className\":\"eYLVum idAuzh \",\"width\":27,\"height\":27,\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 935 935\",\"children\":[\"$\",\"path\",null,{\"d\":\"$f\"}]}],[\"$\",\"span\",null,{\"children\":\"Sukka's Blog\"}]],\"href\":\"/\",\"className\":\"foGVKH joyWtj gSBWlu jTjNVR iKck hNjeNG bmFLeF bcjLCN hriXhD jsvbrX hAnxdy eMqxAe fythwq kfioal gMbFCA hvlmEN bEFzbu gVPbva jYHYOt cPtweL cKdMFV iLdtFu\"}]}],[\"$\",\"div\",null,{\"className\":\"jYEAGD gSBWlu iGDTOy dvivnl kllcGV hriXhD jhobBG ehyqPH gVbVXo jnvyJO dxhWkM hOttdb eMigyT gyjuWy iXsGkK fNXYAQ\",\"children\":[[\"$\",\"div\",null,{\"className\":\"fPWmiY jYEAGD gSBWlu hriXhD gwECLD RVvXa \",\"children\":[[\"$\",\"$Le\",null,{\"children\":\"首页\",\"href\":\"/\",\"className\":\"foGVKH joyWtj gSBWlu jTjNVR iKck hNjeNG bmFLeF bcjLCN hriXhD jsvbrX hAnxdy eMqxAe fythwq kfioal kjthhw hvlmEN bEFzbu gVPbva jYHYOt cPtweL\"}],[\"$\",\"$Le\",null,{\"prefetch\":false,\"children\":\"归档\",\"href\":\"/archives/\",\"className\":\"foGVKH joyWtj gSBWlu jTjNVR iKck hNjeNG bmFLeF bcjLCN hriXhD jsvbrX hAnxdy eMqxAe fythwq kfioal kjthhw hvlmEN bEFzbu gVPbva jYHYOt cPtweL\"}],[\"$\",\"$Le\",null,{\"prefetch\":false,\"children\":\"标签\",\"href\":\"/tags/\",\"className\":\"foGVKH joyWtj gSBWlu jTjNVR iKck hNjeNG bmFLeF bcjLCN hriXhD jsvbrX hAnxdy eMqxAe fythwq kfioal kjthhw hvlmEN bEFzbu gVPbva jYHYOt cPtweL\"}],[\"$\",\"a\",null,{\"target\":\"_blank\",\"children\":\"友链\",\"href\":\"https://skk.moe/friends/\",\"className\":\"foGVKH joyWtj gSBWlu jTjNVR iKck hNjeNG bmFLeF bcjLCN hriXhD jsvbrX hAnxdy eMqxAe fythwq kfioal kjthhw hvlmEN bEFzbu gVPbva jYHYOt cPtweL\"}]]}],[\"$\",\"div\",null,{\"className\":\"fXzCvR jYEAGD gSBWlu hriXhD kBluOZ \",\"children\":[[\"$\",\"a\",null,{\"title\":\"订阅 Atom RSS\",\"aria-label\":\"订阅 Atom RSS\",\"target\":\"_blank\",\"children\":[\"$\",\"i\",null,{\"className\":\"cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ julXB dhOkuk kvHVCE bmIqBL kkyOwP jVKJhP qOQRo ftrJDm dnkCBy iqzSxf dmwCYz krYnfk efugix iOXMHb jZLyOQ hmvKGL bHfPfT fqXcHQ haKUHj dyMCpl hVfwnH jtnuen fSuxSX mupLC kvABFJ diZuuN feNfPp eEMCdD icbECa iwRviO jXtueo eGyfkC hhBXzE iyXZtO jxivWg hZGkn eoMfVT gAMqeS dUvWpK hRLVFh\"}],\"href\":\"/atom.xml\",\"className\":\"foGVKH joyWtj gSBWlu jTjNVR iKck hNjeNG bmFLeF bcjLCN hriXhD jsvbrX hAnxdy eMqxAe fythwq kfioal kjthhw hvlmEN bEFzbu gVPbva jYHYOt cPtweL\"}],[\"$\",\"$Le\",null,{\"prefetch\":false,\"title\":\"搜索\",\"aria-label\":\"搜索\",\"children\":[\"$\",\"i\",null,{\"className\":\"cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ ecjlX bsEZrB cFxYsm julXB dhOkuk kvHVCE kKTZiz jYPXoJ dHPLeJ khRGdg jTqZiD eZgLzs kSnqYR fgiDpI eeAUEW jVKJhP qOQRo ftrJDm dnkCBy gYzjFZ fqXcHQ haKUHj dyMCpl cDbGzW kCTVgr bXZfaW eGyfkC eHPmEw\"}],\"href\":\"/search/\",\"className\":\"foGVKH joyWtj gSBWlu jTjNVR iKck hNjeNG bmFLeF bcjLCN hriXhD jsvbrX hAnxdy eMqxAe fythwq kfioal kjthhw hvlmEN bEFzbu gVPbva jYHYOt cPtweL\"}],[\"$\",\"$L10\",null,{\"darkModeIcon\":[\"$\",\"i\",null,{\"className\":\"cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ ecjlX kZUyqD bnZlqK julXB dhOkuk kvHVCE iWTomA dHAGLH gjJuRC fkwBrJ kSnqYR fgiDpI eeAUEW jVKJhP dnkCBy jXxzWT dUvFSi dyRDAr jZLyOQ jmNtxT gYzjFZ fqXcHQ haKUHj dyMCpl kevfEr dXSlMo blOcGi kYIKui jprGzp lglFlp eGyfkC hhBXzE iyXZtO fSuxSX mupLC kvABFJ diZuuN feNfPp\"}],\"dropdownItems\":[[\"auto\",\"跟随系统\",[\"$\",\"i\",null,{\"className\":\"ycSPk HmWRT cCicDg cpOcAb hHGIsI grHSrK dwPPpV cjScYX fygwnR bLHLvQ clggEI julXB dhOkuk kvHVCE bBBCYN esZiVn jcdXha lddzvY fBCGEU fnmewx diXYbC clnLDU dyRDAr iMyxuR fqXcHQ haKUHj dyMCpl dTLRMT dEwgjP kqqapa eRRcjA ksiuGW jjSfRQ jGavTN cvZIUP hwgZgR jcriRr jJxoa_D fkwxTM FwRrA cDIyHz hpBjJb ffbUph drQFyW guDqdJ HHFdq kbNELw\"}]],[\"dark\",\"总是深色\",[\"$\",\"i\",null,{\"className\":\"ycSPk HmWRT cCicDg cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ julXB dhOkuk kvHVCE hCTuXM cqyuit iOXMHb jZLyOQ ckuioQ bpUXLH fqXcHQ haKUHj dyMCpl ddOAJU cDbSRB fSuxSX mupLC kvABFJ diZuuN fduTvg foSflz dIXgCb eZCezH eGyfkC hhBXzE iyXZtO jxivWg hZGkn eoMfVT iIaSYR jcriRr clJfeA kimLBn iHrpsk fPwJri dUvWpK hRLVFh kYMbqc jJxoa_D fkwxTM FwRrA cDIyHz hpBjJb cPyiZX\"}]],[\"light\",\"总是浅色\",[\"$\",\"i\",null,{\"className\":\"cVpVbF ycSPk gpqukG eVDZRw cpOcAb kEosRl hlAWTI dwPPpV cjScYX fygwnR bLHLvQ julXB dhOkuk kvHVCE hCTuXM cqyuit diXYbC kIyJuJ kCegIa iqzSxf glirVM fqXcHQ haKUHj dyMCpl kevfEr dXSlMo jxOsDC cvZIUP feRPlP eHPmEw lhDlEh knEjmf hPkKtd kTaoUu hcvKPp clJfeA kimLBn iHrpsk fPwJri KqcXP iZmYTt iwdtlA FwRrA cDIyHz hpBjJb bnHkVP dRUvtj cPyiZX kDQnHp fBNSsV cdsFFs dsCnNc gQEmjr\"}]]]}]]}]]}]],\"className\":\"jYEAGD kQBRAp iGDTOy jTjNVR jdraHW hNjeNG eqrBPF iAfHVR jZdtRd cGCNzc gnKwbg\"}]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"kQBRAp bkSasJ eBzqiJ jNLCbB lnHxHM edsxqC GlVkd \",\"children\":[\"$\",\"div\",null,{\"className\":\"fcXWHl  dark\"}]}],[[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$11\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"gSBWlu kooHYa IVbXa foGVKH iMkoWi dQPgRK eKlQYW gCyRDn latiKE sFNbj evdPrE gxEkDX dkWiBb iQmyKI kHUQvx hIa_dhX giuvA ctIwOA dKqzWb gcVpWM \",\"children\":[[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":\"2\",\"className\":\"dcsbFK fWGxWC kOqOXj \",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z\"}],[\"$\",\"path\",null,{\"d\":\"m8 16 6-2 2-6-6 2z\"}]]}],[\"$\",\"div\",null,{\"className\":\"gSBWlu iMkoWi cQQQFz egGyMq \",\"children\":[[\"$\",\"p\",null,{\"className\":\"jfXcDa jxySid hHyHSZ \",\"children\":\"What are you looking for?\"}],[\"$\",\"p\",null,{\"className\":\"cQQQFz kuqFxU fUqtKm eApAOW \",\"children\":\"Maybe this link is broken. Maybe something was deleted, or moved. In any case, there’s nothing to see here.\"}],[\"$\",\"p\",null,{\"className\":\"bqLlHT kuqFxU fUqtKm eApAOW \",\"children\":[\"You can try using \",[\"$\",\"$Le\",null,{\"href\":\"/search/\",\"replace\":false,\"children\":\"search\"}],\" to find the content, or \",[\"$\",\"$Le\",null,{\"href\":\"/\",\"children\":\"back to homepage\"}],\".\"]}]]}]]}],\"notFoundStyles\":[],\"styles\":null}],[\"$\",\"$L12\",null,{}]]],\"className\":\"kQBRAp jTjNVR jdraHW hNjeNG eqrBPF iAfHVR kVZHcH eZoUck gxEkDX eSbexu eHziYb kHUQvx jGVMPF fspmWo bTobTI hMTODI dTSmlT jZdtRd huuFUS cGCNzc\"}],[\"$\",\"footer\",null,{\"className\":\"kooHYa evdPrE diLtXU eoqbKT cTVtxN iZcyKt jXUIWe epEjwu kKplrA \",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"div\",null,{\"children\":[\"Copyright © 2018 - \",[\"$\",\"$L13\",null,{\"year\":2023}],\" \",[\"$\",\"$Le\",null,{\"prefetch\":false,\"children\":\"Sukka's Blog\",\"href\":\"/\",\"className\":\"hNyMbp \"}]]}],[\"$\",\"div\",null,{\"children\":[\"Powered by\",\" \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener nofollow noreferrer\",\"children\":\"Hexo\",\"href\":\"https://hexo.io/\",\"className\":\"hNyMbp \"}],\" \u0026 \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener nofollow noreferrer\",\"children\":\"Next.js\",\"href\":\"https://nextjs.org/\",\"className\":\"hNyMbp \"}],[\"$\",\"span\",null,{\"className\":\"jTjNVR hIrAsl hNjeNG dDVQEX gKQCBv \"}],\"Designed by\",\" \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener nofollow noreferrer\",\"children\":\"Sukka\",\"href\":\"https://skk.moe\",\"className\":\"hNyMbp \"}]]}]],\"className\":\"iGDTOy jTjNVR jdraHW hNjeNG eqrBPF iAfHVR jZdtRd cGCNzc eIBfQn kKkndf\"}]}]]}]}]]}]]}],null]],\"initialHead\":[false,\"$L14\"],\"globalErrorComponent\":\"$15\",\"missingSlots\":\"$W16\"}]]\n"])</script><script>self.__next_f.push([1,"17:I[582,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"814\",\"static/chunks/814-3cf4e65a9b2d7c50.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-9958399dd600bb2a.js\"],\"\"]\n18:I[5066,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"814\",\"static/chunks/814-3cf4e65a9b2d7c50.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-9958399dd600bb2a.js\"],\"\"]\n19:I[4724,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"814\",\"static/chunks/814-3cf4e65a9b2d7c50.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-9958399dd600bb"])</script><script>self.__next_f.push([1,"2a.js\"],\"\"]\n1a:I[3217,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"814\",\"static/chunks/814-3cf4e65a9b2d7c50.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-9958399dd600bb2a.js\"],\"ErrorBoundary\"]\n1b:I[3109,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"814\",\"static/chunks/814-3cf4e65a9b2d7c50.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-9958399dd600bb2a.js\"],\"\"]\n1d:I[8013,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"980\",\"static/chunks/app/post/%5Bslug%5D/error-a7ebf72f754b6631.js\"],\"\"]\n1f:I[29"])</script><script>self.__next_f.push([1,"35,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"385\",\"static/chunks/385-81234ac0c2374888.js\",\"609\",\"static/chunks/app/post/%5Bslug%5D/layout-62df7fa213f3ef72.js\"],\"\"]\n20:I[9763,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"385\",\"static/chunks/385-81234ac0c2374888.js\",\"609\",\"static/chunks/app/post/%5Bslug%5D/layout-62df7fa213f3ef72.js\"],\"\"]\n21:I[3543,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"385\",\"static/chunks/385-81234ac0c2374888.js\",\"609\",\"static/chunks/app/post/%5Bslug%5D/layout-62df7fa213f3ef"])</script><script>self.__next_f.push([1,"72.js\"],\"\"]\n28:I[8395,[\"697\",\"static/chunks/697-c8d30c5edb9941df.js\",\"385\",\"static/chunks/385-81234ac0c2374888.js\",\"609\",\"static/chunks/app/post/%5Bslug%5D/layout-62df7fa213f3ef72.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"article\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe \",\"children\":[[\"$\",\"div\",null,{\"className\":\"izjaRz irHqxI hPkSBF dIuexX kQBRAp cjScYX bJFUmL cgfcWS iIkwhh lhFAgM \",\"children\":[\"$\",\"$L17\",null,{\"alt\":\"浅谈在代理环境中的 DNS 解析行为\",\"src\":\"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png\",\"webp\":\"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png.webp\",\"priority\":true,\"noscript\":[\"$\",\"noscript\",null,{\"children\":[\"$\",\"img\",null,{\"alt\":\"浅谈在代理环境中的 DNS 解析行为\",\"decoding\":\"async\",\"crossOrigin\":\"anonymous\",\"loading\":\"$undefined\",\"className\":\"gWinOH cRUUAa gdPTUr kQBRAp bEvNbr bLIxaN bOjOhu kLKrsq WhAZY \",\"src\":\"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png\"}]}]}]}],[\"$\",\"header\",null,{\"className\":\"kWUGWQ diLtXU iATxZH cTVtxN \",\"children\":[[\"$\",\"h1\",null,{\"children\":\"浅谈在代理环境中的 DNS 解析行为\",\"className\":\"kiMAEz buowod rXoKk dIAaBe hyjQvk ctpWtp\"}],[\"$\",\"div\",null,{\"className\":\"epEjwu \",\"children\":[[\"$\",\"time\",null,{\"dateTime\":\"2019-07-22T09:13:00.000Z\",\"children\":\"2019-07-22\"}],[[[\"$\",\"span\",null,{\"className\":\"jTjNVR hIrAsl hNjeNG dDVQEX gKQCBv \"}],[\"$\",\"$Le\",null,{\"href\":\"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/\",\"prefetch\":false,\"className\":\"epEjwu \",\"children\":\"技术向\"}]]],[\"$\",\"span\",null,{\"className\":\"jTjNVR hIrAsl hNjeNG dDVQEX gKQCBv \"}],\"约 5.2 千字\"]}]]}],[\"$\",\"$L18\",null,{\"title\":\"浅谈在代理环境中的 DNS 解析行为\",\"license\":\"$undefined\",\"permalink\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\",\"children\":[[\"$\",\"p\",null,{\"children\":\"虽然 Fake IP 这个概念早在 2001 年就被提出来了，但是到 Clash 提供 fake-ip 增强模式以后，依然有很多人对 Fake IP 这个概念以及其作用知之甚少。本文就简单谈谈在代理环境中，TCP 连接建立之前发生的事。由于移动设备操作系统中网络栈相对复杂，本文的例子也并不一定适用于移动端环境。文章中也许会存在很多错误，也希望各路大佬的勘误和斧正。\"}],[\"$\",\"h2\",null,{\"id\":\"Bu-Shi-Yong-Dai-Li\",\"children\":\"不使用代理\"}],[\"$\",\"p\",null,{\"children\":[\"如果在不使用任何代理的情况下，打开一个没有命中 DNS 缓存的网站（比如 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\"）的时候，浏览器和操作系统大概会执行这么一些操作：\"]}],[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器自己都有 DNS 缓存机制，因此浏览器会先开始寻找自己的缓存，不过没有找到 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的解析结果\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器通过调用操作系统的 \",[\"$\",\"code\",null,{\"children\":\"getaddrinfo\"}],\" 方法，向操作系统寻求解析结果\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"操作系统自己也有一层 DNS 缓存，但是现在操作系统从自己的缓存中依然找不到这一结果\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"在系统的网络设置之中有设置上游 DNS 地址，假设操作系统中设置的是 \",[\"$\",\"code\",null,{\"children\":\"119.29.29.29\"}],\"，那么操作系统会向 \",[\"$\",\"code\",null,{\"children\":\"119.29.29.29\"}],\" 发起解析请求（UDP 流量）拿到 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的 IP\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"当然如果 \",[\"$\",\"code\",null,{\"children\":\"119.29.29.29\"}],\" 自己没有 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的解析结果会找它的上游去要。不过我们不关心这一点，反正最后 \",[\"$\",\"code\",null,{\"children\":\"119.29.29.29\"}],\" 会把 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的解析结果返回给设备的操作系统\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"现在，浏览器已经可以开始向 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的 IP 发起 HTTPS 连接了\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"以上是打开一个网页常见的 DNS 解析流程，对于其它非 HTTP 的 TCP 连接（比如 SMTP）也都差不多是这个流程——由于 TCP/IP 的协议特性，在应用发起 TCP 连接时，会先发出一个 DNS question（发一个 IP Packet），获取要连接的服务器的 IP 地址，然后直接向这个 IP 地址发起连接。\"}],[\"$\",\"h2\",null,{\"id\":\"She-Zhi-Dai-Li-Bing-Shi-Yong-Zhi-Lian\",\"children\":\"设置代理并使用直连\"}],[\"$\",\"p\",null,{\"children\":\"现在，我们在应用程序（比如我们的浏览器、或者其它应用）中设置了代理，但是这个代理不涉及到任何远端服务器（直连模式）。接下来以设置了 SOCKS5 代理的浏览器为例。\"}],[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器不再需要从自己的 DNS 缓存中寻找 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\"，因为已经有了 SOCKS5 代理，浏览器可以直接将域名封装在 SOCKS5 流量之中发往代理客户端\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"代理客户端从 SOCKS5 流量中抽出 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 这个域名并设法获得解析结果\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"代理客户端将你的 SOCKS5 流量还原成标准的 TCP 请求\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"代理客户端将这个 TCP 连接建立起来，在这个例子之中 TCP 连接承载的是 HTTPS\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"之前由于获取解析结果是浏览器在操作，而大部分浏览器都会选择调用系统的 \",[\"$\",\"code\",null,{\"children\":\"getaddrinfo\"}],\" 方法，因此如果你想要在 DNS 上做一些黑魔法就只能在操作系统层面实现，比如在本机或者别处架设一个带黑魔法的 DNS 服务器，然后你系统中设置使用这个 DNS 服务器。现在 DNS 解析是由代理客户端执行，因此在代理客户端上就可以实现一些黑魔法。比如 Surge 自己实现了一个 DNS Server 可以并发向多个上游同时发起查询、比如 V2Ray 可以实现不同域名的查询分流，等等。当然代理客户端也可以使用操作系统的 \",[\"$\",\"code\",null,{\"children\":\"getaddrinfo\"}],\" 方法。\"]}],[\"$\",\"h2\",null,{\"id\":\"She-Zhi-Dai-Li-Bing-Jiang-Liu-Liang-Zhuan-Fa-Dao-Yuan-Duan-Fu-Wu-Qi\",\"children\":\"设置代理并将流量转发到远端服务器\"}],[\"$\",\"p\",null,{\"children\":\"现在在上一步的基础之上，我们为代理服务器设置了一个远端服务器，这个代理会使用 某种协议 和远端服务器通信，并且这种协议和 SOCKS5 一样支持将域名封装在传输中。浏览器和代理客户端之间依然使用 SOCKS5 通信。\"}],[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"因为已经有了 SOCKS5 代理，浏览器可以直接将域名 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 和整个请求封装在 SOCKS5 流量之中发往代理客户端\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"代理客户端从 SOCKS5 流量中抽出 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 这个域名以及其它数据\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"代理客户端使用 某种协议 将浏览器发出的 SOCKS5 的流量重组并发给远端服务器\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"远端服务器使用相同的 某种协议 从流量中获得其中的域名 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"远端服务器的代理服务端发起了一次 DNS 解析请求试图解析 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\"。绝大部分情况下，代理的服务端都会直接使用操作系统的 \",[\"$\",\"code\",null,{\"children\":\"getaddrinfo\"}],\" 方法、也就是由远端服务器的操作系统负责 DNS\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"这一次，不论是代理客户端还是你的浏览器都没有进行 DNS 解析，DNS 解析是在远端服务器上进行的。因为 某种协议 支持封装域名，然后这一次和 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 连接的是远端服务器，考虑到针对 CDN 优化，DNS 解析自然需要在远端服务器上执行。\"]}],[\"$\",\"p\",null,{\"children\":\"现在我已经介绍了通过代理直连和通过代理发送给远端服务器了。但是毫无疑问，我相信本文所有的读者自己使用的上网方式都不会是全面直连或者全面代理。这就是接下来要讲的：\"}],[\"$\",\"h2\",null,{\"id\":\"She-Zhi-Dai-Li-Bing-Shi-Yong-IP-Gui-Ze-He-Yu-Ming-Gui-Ze-Jin-Xing-Fen-Liu\",\"children\":\"设置代理并使用 IP 规则和域名规则进行分流\"}],[\"$\",\"p\",null,{\"children\":\"分流是一个麻烦事。一般情况下，你可能会需要使用域名进行分流（不论是白名单还是黑名单）。不过更多情况下你会使用到基于 IP 的规则来进行分流。\"}],[\"$\",\"p\",null,{\"children\":\"先来看第一个例子：使用域名规则进行分流。\"}],[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器将带有域名 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的 HTTPS 请求封装在 SOCKS5 流量之中发往代理客户端\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"代理客户端从 SOCKS5 流量中抽取出域名 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"代理客户端开始将\",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 和域名规则列表开始比较。这个列表可以是白名单或黑名单，域名可能也没有匹配上。反正最终比较得出的结果就是 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 是否需要走代理。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"如果不需要走代理，代理客户端剩下会做的事情和本文第二部分「设置代理并使用直连」就完全一样了；同理，需要走代理的话就需要进行本文第三部分的那个流程\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"使用域名规则分流很简单，除非 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 最终是直连，否则代理客户端不需要进行 DNS 解析。\"]}],[\"$\",\"p\",null,{\"children\":\"现在来看第二个例子：使用 IP 规则分流。\"}],[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器将带有域名 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的 HTTPS 请求封装在 SOCKS5 流量之中发往代理客户端\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"代理客户端从 SOCKS5 流量中抽取出域名 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"代理客户端得到 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的解析结果\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"代理客户端开始将\",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的解析结果和 IP 规则列表开始比较。这个列表可以是 cnlist 或者 MaxMind IP 数据库。反正最终得出的结果就是 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 解析结果的 IP 是否需要走代理。\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"如果不需要走代理，代理客户端剩下会做的事情和本文第二部分「设置代理并使用直连」就完全一样了；同理，需要走代理的话就需要进行本文第三部分的那个流程。\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"使用 IP 规则分流，前提首先你得有一个 IP 拿来比较。所以代理客户端必须先进行一次 DNS 解析。使用什么方法进行 DNS 解析并不重要，之前已经说过代理客户端甚至可以使用自己的黑魔法，而我们只需要关心最终代理客户端拿到了一个 IP 并且可以用于规则判定。\"}],[\"$\",\"p\",null,{\"children\":\"此时需要注意的是，虽然代理客户端获得了一个 IP，但是你只有在直连的时候，代理客户端可能（并且基本上都会）复用这个 IP；如果是将流量交给远程服务器，由于 某种协议 支持封装域名，因此远程服务器拿到的还是域名不是 IP、还需要进行一次解析。也就是说，远端服务器连接的 IP 与 代理客户端解析得到的 IP 毫无关系。\"}],[\"$\",\"h2\",null,{\"id\":\"Shi-Yong-redir-x2F-tun2socks-Shi-Xian-Quan-Ju-Liu-Liang-Jing-Guo-Dai-Li\",\"children\":\"使用 redir / tun2socks 实现全局流量经过代理\"}],[\"$\",\"p\",null,{\"children\":\"在开始之前，我们先复习一下 TCP/IP 协议怎么说的——「在应用发起 TCP 连接时，会先发出一个 DNS question（发一个 IP Packet），获取要连接的服务器的 IP 地址，然后直接向这个 IP 地址发起连接」\"}],[\"$\",\"p\",null,{\"children\":\"全局流量代理可能会出现在路由器上或者 TUN/TAP 型的支持全局代理客户端上。用户不再主动为每个应用程序设置代理。此时应用程序是不会感知到代理客户端的存在，它们会正常的发起 TCP 连接，并且由于 TCP/IP 协议，在拿到 DNS 解析结果之前，连接是不能建立的。\"}],[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器自己都有 DNS 缓存机制，因此浏览器会先开始寻找自己的缓存，不过没有找到 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的解析结果\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器通过调用操作系统的 \",[\"$\",\"code\",null,{\"children\":\"getaddrinfo\"}],\" 方法，向操作系统寻求解析结果\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"操作系统自己也有一层 DNS 缓存，但是现在操作系统从自己的缓存中依然找不到这一结果\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"在系统的网络设置之中有设置上游 DNS 地址。代理客户端可能会修改系统设置中的 DNS 到 127.0.0.1 或者别的 IP、也可能保留用户之前的设置，这无所谓，因为...\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"操作系统发出的 DNS 解析请求会经过代理客户端并最终被截获\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"代理客户端可以将这个解析请求原样发出去、或者用自己的黑魔法，总之代理客户端都会拿到一个解析结果\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"代理客户端将这个解析结果返回回去，操作系统拿到了这个解析结果并返回给浏览器\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"浏览器对这个解析结果的 IP 建立一个 TCP 连接并发送出去\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"这个 TCP 连接被代理客户端截获。由于之前代理客户端进行的 DNS 解析请求这一动作，代理客户端可以找到这个只包含目标 IP 的 TCP 连接原来的目标域名\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"如果是支持 redir 的代理客户端，那么代理客户端就会直接将域名和 TCP 连接中的其它数据封装成 某种协议 发给远端服务器；或者封装成 SOCKS5 后交给支持 SOCKS5 的代理客户端\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"如果代理客户端需要按照域名进行分流，一般会在第 6 步代理客户端解析出一个 IP 或者第 9 步代理客户端拿到域名以后。FancySS、KoolSS、SSTap 的流程大抵都是如此。\"}],[\"$\",\"p\",null,{\"children\":[\"和应用程序直接将流量封装成 SOCKS5 大有不同，在类似于透明代理的环境下浏览器和其它应用程序是正常地发起 TCP 连接。因此除非得到一个 DNS 解析结果，否则 TCP 连接不会建立；代理客户端也会需要通过这个 DNS 查询动作，才能找到之后的 TCP 连接的域名。\",[\"$\",\"br\",null,{\"children\":null}],\"你大概能够发现，浏览器、应用程序直接设置 SOCKS5 代理的话，可以不在代理客户端发起 DNS 解析请求就能将流量发送给远端服务器；而在透明代理模式下，不论是否需要 IP 规则分流都需要先进行一次 DNS 解析才能建立连接。\"]}],[\"$\",\"p\",null,{\"children\":\"有没有办法能像直接设置 SOCKS5 代理一样省掉一次 DNS 解析呢？有，就是代理客户端自己不先执行查询动作，丢一个 Fake IP 回去让浏览器、应用程序立刻建立 TCP 连接：\"}],[\"$\",\"h2\",null,{\"id\":\"Zai-redir-x2F-tun2socks-Zhong-Shi-Yong-Fake-IP\",\"children\":\"在 redir / tun2socks 中使用 Fake IP\"}],[\"$\",\"p\",null,{\"children\":[\"Fake IP 的定义出自 \",[\"$\",\"a\",null,{\"children\":\"RFC3089\",\"href\":\"https://tools.ietf.org/rfc/rfc3089\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer external nofollow\"}],\"。这个 RFC 定义了一种新的将 TCP 连接封装成 SOCKS 协议的方法。\"]}],[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器自己都有 DNS 缓存机制，因此浏览器会先开始寻找自己的缓存，不过并没有找到 \",[\"$\",\"code\",null,{\"children\":\"blog.skk.moe\"}],\" 的解析结果\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"浏览器通过调用操作系统的 \",[\"$\",\"code\",null,{\"children\":\"getaddrinfo\"}],\" 方法，向操作系统寻求解析结果\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"操作系统自己也有一层 DNS 缓存，但是现在操作系统从自己的缓存中依然找不到这一结果\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"在系统的网络设置之中设置了一个专门的上游 DNS 地址，可能是用户手动设置的也可能是代理客户端设置的。不论如何，这个设置最终会使操作系统向代理客户端发起 DNS 请求\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"操作系统发出的 DNS 解析请求会经过代理客户端并最终被截获\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"代理客户端从解析请求中获得域名，从 Fake IP 池中选取一个 IP 建立映射\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"代理客户端将这个 Fake IP 返回回去，操作系统拿到了这个 Fake IP 并返回给浏览器\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"浏览器对 Fake IP 建立一个 TCP 连接并发送出去\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"这个 TCP 连接被代理客户端截获。代理客户端抽取出 Fake IP 并反查出这个 TCP 连接中对应的域名\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"有了 TCP 连接和域名，代理客户端可以轻易地将其使用 SOSCKS5 或者 某种协议 进行封装\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"有了 Fake IP，代理客户端无需进行 DNS 解析。最后不论是浏览器、代理客户端还是远端服务器都不会去和 Fake IP 进行连接，因为在代理客户端这里就已经完成了截获、重新封装。\"}],[\"$\",\"p\",null,{\"children\":\"即使按照域名规则分流，代理客户端都没有进行 DNS 解析的需要。只有在遇到了按照 IP 进行分流的规则时，代理客户端才需要进行一次解析拿到一个 IP 用于判断。即便如此，这个 IP 只用于分流规则的匹配，不会被用于实际的连接。\"}],[\"$\",\"h2\",null,{\"id\":\"FancySS-He-Surge-x2F-Clash-De-Qu-Bie\",\"children\":\"FancySS 和 Surge / Clash 的区别\"}],[\"$\",\"p\",null,{\"children\":\"FancySS 是使用的 redir，Surge 的增强模式使用的是 Fake IP，Clash 的增强模式既有 redir-host 也有 Fake IP。首先把 FancySS 等路由器上常见的代理客户端和 Clash 的 redir-host 分为一类，Surge 的增强模式和 Clash 的 fake-ip 模式分为另一类。\"}],[\"$\",\"p\",null,{\"children\":[\"路由器上常见的代理客户端一般内置了 dns2socks、dnscryp-proxy、PCap_DNSProxy 等等 DNS 方案、也支持按照一定的规则进行分流，但是都是用于答复应用程序的 DNS question 使其建立 TCP 连接的，除非直连，否则通过这些 DNS 方案拿到的解析结果的 IP 并不会被用上。\",[\"$\",\"br\",null,{\"children\":null}],\"大部分路由器上的代理客户端，DNS 解析请求都是通过路由器本机发出（或转发到单一远端服务器进行解析），因此解析结果只能说「至少能用」（不一定是有 CDN 优化的，甚至有可能会有 DNS 污染），如果流量不经过代理客户端直接发往这些 IP 地址，一般也不会影响浏览器、应用程序的正常使用。因此路由器上的代理客户端可以实现通过 iptables 控制让某些端口、某些设备的流量不经过代理客户端。\",[\"$\",\"br\",null,{\"children\":null}],\"而在 Fake IP 模式下，浏览器、应用程序都是对 Fake IP 发起连接，如果没有代理客户端对连接进行重新封转，那么这部分流量就不能被发往真实的目的 IP，因此所有流量都必须经过代理客户端，而根据端口、设备的分流就需要由代理客户端自己实现。\"]}],[\"$\",\"h2\",null,{\"id\":\"Ru-Guo-Cao-Zuo-Xi-Tong-Huo-Zhe-Liu-Lan-Qi-Huan-Cun-Liao-DNS-Jie-Xi-Jie-Guo\",\"children\":\"如果操作系统或者浏览器缓存了 DNS 解析结果\"}],[\"$\",\"p\",null,{\"children\":\"之前的透明代理的两个例子中，我们都假定浏览器和操作系统都没有缓存 DNS 解析结果。但是，如果操作系统或者应用程序缓存了 DNS 解析结果会发生什么？\"}],[\"$\",\"p\",null,{\"children\":[\"如果是不使用 Fake IP 的 redir / tun2socks 情况下，由于操作系统、浏览器或者应用程序中的任何一个缓存了 DNS 解析结果，因此 TCP 连接可以直接根据缓存的解析结果的 IP 建立，代理客户端并没有预先收到对应的 DNS question。在这种情况下，代理客户端有可能直接将这个连接视为和 IP 连接而不是和域名连接，根据域名规则的分流可能就会因此失效，不过根据 IP 分流的规则没有失效。\",[\"$\",\"br\",null,{\"children\":null}],\"如果为了避免域名分流规则失效，你可以设法阻止操作系统或者浏览器缓存 DNS 解析结果，这样每次建立 TCP 连接之前都会发送 DNS question 使代理客户端探测到域名。但是这意味着每次 TCP 连接建立都需要代理客户端进行一次 DNS 解析请求（当然代理客户端可以对 DNS 解析进行缓存避免出现延时激增）。\"]}],[\"$\",\"p\",null,{\"children\":\"而对于 Fake IP 模式来说，由于代理客户端内存储有 Fake IP 和真实域名之间的映射表，因此即使操作系统或应用程序缓存了 Fake IP，在之后的 TCP 连接中，代理客户端收到流量后依然可以抽取出 Fake IP 反查出域名，因此不受 DNS 缓存的影响。\"}],[\"$\",\"p\",null,{\"children\":\"我在这里留几个问题给大家思考一下：\"}],[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"如果使用了 Fake IP，代理客户端不论域名是否真实存在都会返回一个 Fake IP 给浏览器，那么浏览器在试图访问一个不存在的域名时，错误信息应该是什么样的？会不会出现 DNS 解析失败的错误信息？\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"如果操作系统或者浏览器缓存了 Fake IP，但是代理客户端中 Fake IP 和域名的映射表丢失以后，会出现什么状况？可能会出现什么错误信息？\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"第二个问题很有趣。因为如果你找到了第二个问题的答案，你就会意识到 Clash 在 Fake IP 模式下偶发的无法上网的原因了。\"}],[\"$\",\"h2\",null,{\"id\":\"Can-Kao-Zi-Liao-2\",\"children\":\"参考资料\"}],[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"children\":\"HTTP 代理原理及实现（一）\",\"href\":\"https://imququ.com/post/web-proxy.html\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer external nofollow\"}],\" - 我的文章中举得都是 SOCKS5 的例子，如果想了解一下在 HTTP 代理中流量是如何被封装的，可以看看屈屈的这篇博客\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"children\":\"Surge 原理与实现\",\"href\":\"https://medium.com/@Blankwonder/surge-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-8aa3304fb3bb\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer external nofollow\"}],\" - Surge 开发者写的 Surge 早期版本的工作原理，可以了解一下 Surge 是怎么处理各种协议的流量的\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"children\":\"漫谈各种黑科技式 DNS 技术在代理环境中的应用\",\"href\":\"https://medium.com/@TachyonDevel/%E6%BC%AB%E8%B0%88%E5%90%84%E7%A7%8D%E9%BB%91%E7%A7%91%E6%8A%80%E5%BC%8F-dns-%E6%8A%80%E6%9C%AF%E5%9C%A8%E4%BB%A3%E7%90%86%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8-62c50e58cbd0\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer external nofollow\"}],\" - Kitsunebi 开发者写的文章，详细地介绍了在不同的 V2Ray 配置下的 DNS 行为，同时还有对移动端网络栈的一些介绍\"]}],\"\\n\"]}],\"\\n\"]}],[\"$\",\"div\",null,{\"className\":\"dwPPpV cjScYX kQBRAp bTNDYw ffGozt gZtkYs dUvWpK hRLVFh gXlVLa diLtXU Vabsy cTVtxN \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jTjNVR iKck dIRDTl bmFLeF \",\"children\":\"浅谈在代理环境中的 DNS 解析行为\"}],[\"$\",\"div\",null,{\"className\":\"hyjQvk diNRrl kZxEXA \",\"children\":[\"$\",\"$Le\",null,{\"href\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\",\"prefetch\":false,\"className\":\"bEAqvP dLUwcr \",\"children\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\"}]}],[\"$\",\"div\",null,{\"className\":\"gSBWlu foGVKH fPWmiY kiDYix \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jTjNVR jmCeQl dJntus bmFLeF \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jTjNVR iKck dIRDTl bmFLeF diNRrl \",\"children\":\"本文作者\"}],[\"$\",\"div\",null,{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":\"Sukka\"}]]}],[\"$\",\"div\",null,{\"className\":\"jTjNVR jmCeQl dJntus bmFLeF \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jTjNVR iKck dIRDTl bmFLeF diNRrl \",\"children\":\"发布于\"}],[\"$\",\"div\",null,{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":\"2019-07-22\"}]]}],false,[\"$\",\"div\",null,{\"className\":\"jTjNVR jmCeQl dJntus bmFLeF \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jTjNVR iKck dIRDTl bmFLeF diNRrl \",\"children\":\"许可协议\"}],[\"$\",\"div\",null,{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"a\",null,{\"href\":\"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh\",\"target\":\"_blank\",\"rel\":\"nofollow noopener noreferrer\",\"className\":\"bEAqvP dLUwcr \",\"children\":\"CC BY-NC-SA 4.0\"}]}]]}]]}],[\"$\",\"div\",null,{\"children\":\"转载或引用本文时请遵守许可协议，注明出处、不得用于商业用途！\"}],[\"$\",\"i\",null,{\"className\":\"ycSPk iknnvS bWydik cpOcAb kKDTSU emVtrI dwPPpV bEvNbr fygwnR bLHLvQ ecjlX hvmOHQ ouiRd julXB dhOkuk kvHVCE jmTvKz dResSS jVKJhP qOQRo ftrJDm dnkCBy cDbpcH kZwOdx kSnqYR fgiDpI eeAUEW bnSwfb cOQHkb bVHlsq cKWmox jZLyOQ bUxwiT hQJXjP fqXcHQ haKUHj dyMCpl kevfEr hyOZDn fSuxSX mupLC kvABFJ diZuuN gaNphp fdFwfp eGyfkC hhBXzE iyXZtO hZGkn icYpyF jkOwii jXmaZg joeSnw clJfeA kimLBn iHrpsk fPwJri eZZAwM ktIykT FwRrA cDIyHz hpBjJb dZDNG bynUJ ialQbk\"}]]}],[\"$\",\"$L19\",null,{\"isoDate\":\"2019-07-22T09:13:00.000Z\"}],[\"$\",\"footer\",null,{\"className\":\"gSBWlu kiDYix fPWmiY kWUGWQ diLtXU gxEkDX cTVtxN cVRxWB dXWgbR \",\"children\":[[[\"$\",\"$Le\",\"技术向\",{\"href\":\"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/\",\"prefetch\":false,\"className\":\"fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk hNyMbp guWNSJ ddysuV gOjCJU cduofK SNIUj eMVBWN \",\"children\":[\"# \",\"技术向\"]}]],[[\"$\",\"$Le\",\"DNS\",{\"rel\":\"tag\",\"href\":\"/tags/DNS/\",\"prefetch\":false,\"className\":\"fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet \",\"children\":[\"# \",\"DNS\"]}],[\"$\",\"$Le\",\"Surge\",{\"rel\":\"tag\",\"href\":\"/tags/Surge/\",\"prefetch\":false,\"className\":\"fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet \",\"children\":[\"# \",\"Surge\"]}],[\"$\",\"$Le\",\"Clash\",{\"rel\":\"tag\",\"href\":\"/tags/Clash/\",\"prefetch\":false,\"className\":\"fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet \",\"children\":[\"# \",\"Clash\"]}],[\"$\",\"$Le\",\"Fake IP\",{\"rel\":\"tag\",\"href\":\"/tags/Fake-IP/\",\"prefetch\":false,\"className\":\"fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet \",\"children\":[\"# \",\"Fake IP\"]}],[\"$\",\"$Le\",\"SOCKS5\",{\"rel\":\"tag\",\"href\":\"/tags/SOCKS5/\",\"prefetch\":false,\"className\":\"fkxGrD hMQqff dlOsbI cSgvgr diNRrl clJfeA kimLBn iHrpsk fPwJri izykGz ikqruN ctibpX kzDapR FwRrA cDIyHz hpBjJb ycSPk epEjwu kwyfsE hBma_ds kDUNwo gVjJHb gMbFCA eLnaet \",\"children\":[\"# \",\"SOCKS5\"]}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN kooHYa\",\"children\":[\"$undefined\",[[\"$\",\"div\",null,{\"className\":\"diNRrl hyjQvk bBVwIW \",\"children\":\"喜欢这篇文章？为什么不打赏一下作者呢？\"}],[\"$\",\"a\",null,{\"href\":\"https://afdian.net/@sukka\",\"target\":\"_blank\",\"rel\":\"noopener nofollow noreferrer\",\"className\":\"kcJmwb itAGJL HhHXE bmPsOO foGVKH jhKQav dwPPpV fYpehW hJqMHb fygwnR cirhiC lexxaO izjaRz irHqxI ka_DAXd feZCbt larHMv jmZMAS \",\"children\":\"爱发电\"}]]]}],[\"$\",\"nav\",null,{\"className\":\"gSBWlu hsxujn iKck dZuvvJ bmFLeF dugTDd \",\"role\":\"navigation\",\"children\":[[\"$\",\"div\",null,{\"className\":\"gSBWlu dQPgRK eKlQYW bLlOeF fPWmiY hmKFEM \",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/post/how-koolclash-worked/\",\"prefetch\":false,\"className\":\"gSBWlu dugTDd foGVKH hqSOEl kVZHcH cbEMfi iATxZH liVmWr bbUXPo \",\"children\":[[\"$\",\"i\",null,{\"className\":\"epEjwu cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ ecjlX bsEZrB cFxYsm julXB dhOkuk kvHVCE hCTuXM cqyuit ibSSyM cODSMr kSnqYR fgiDpI eeAUEW gjJuRC iWYpgm jbzBdl fqXcHQ haKUHj dyMCpl kevfEr dXSlMo hIrAsl\"}],[\"$\",\"div\",null,{\"className\":\"jxySid kKRHCo bTNDYw epEjwu \",\"children\":\"KoolClash 的工作机制\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"gSBWlu dQPgRK eKlQYW bLlOeF fXzCvR klEWBS \",\"children\":[\"$\",\"$Le\",null,{\"href\":\"/post/how-regex-caused-cf-global-502/\",\"prefetch\":false,\"className\":\"gSBWlu dugTDd foGVKH hqSOEl kVZHcH cbEMfi iATxZH liVmWr bbUXPo \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jxySid kKRHCo bTNDYw epEjwu \",\"children\":\"[翻译] Cloudflare 在 2019 年 7 月 2 日宕机的技术细节\"}],[\"$\",\"i\",null,{\"className\":\"epEjwu cpOcAb hHGIsI jXmXEB kKRHCo cjScYX fygwnR bLHLvQ ecjlX bTanCN cFxYsm julXB dhOkuk kvHVCE hCTuXM cqyuit iEAnTV kfcRAM kSnqYR fgiDpI eeAUEW jTqZiD iWYpgm bblCYQ fqXcHQ haKUHj dyMCpl kevfEr dXSlMo fsWlQg\"}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN\",\"children\":[\"$undefined\",[\"$\",\"$L1a\",null,{\"fallback\":[\"$\",\"div\",null,{\"className\":\"kooHYa kWUGWQ dwawJR eonfmG jQenOz cDWHSV iKck ecxexf bmFLeF eCuFxb \",\"children\":\"评论加载失败\"}],\"children\":[\"$\",\"$L1b\",null,{\"url\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\",\"identifier\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\",\"fallback\":[\"$\",\"div\",null,{\"className\":\"kooHYa kWUGWQ dwawJR eonfmG jQenOz cDWHSV iKck ecxexf bmFLeF eCuFxb \",\"children\":\"评论加载中...\"}]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"1c:[\"slug\",\"what-happend-to-dns-in-proxy\",\"d\"]\n29:T85b,"])</script><script>self.__next_f.push([1,"[{\"@context\":\"https://schema.org\",\"@type\":\"BlogPosting\",\"@id\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\",\"url\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\",\"articleSection\":\"技术向\",\"author\":{\"@type\":\"Person\",\"name\":\"Sukka\",\"url\":\"https://skk.moe\",\"sameAs\":[\"https://github.com/SukkaW\",\"https://twitter.com/isukkaw\",\"https://t.me/sukkachannel\",\"https://keybase.io/sukka\",\"https://acg.mn/@sukka\"]},\"headline\":\"浅谈在代理环境中的 DNS 解析行为\",\"name\":\"浅谈在代理环境中的 DNS 解析行为\",\"abstract\":\"虽然 Fake IP 这个概念早在 2001 年就被提出来了，但是到 Clash 提供 fake-ip 增强模式以后，依然有很多人对 Fake IP 这个概念以及其作用知之甚少。本文就简单谈谈在代理环境中，TCP 连接建立之前发生的事。由于移动设备操作系统中网络栈相对复杂，本文的例子也并不一定适用于移动端环境。文章中也许会存在很多错误，也希望各路大佬的勘误和斧正。\",\"discussionUrl\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy#disqus_thread\",\"dateCreated\":\"2019-07-22T09:13:00.000Z\",\"datePublished\":\"2019-07-22T09:13:00.000Z\",\"dateModified\":\"2019-07-22T09:13:00.000Z\",\"thumbnailUrl\":\"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png\",\"keywords\":\"DNS, Surge, Clash, Fake IP, SOCKS5\",\"image\":[{\"@type\":\"ImageObject\",\"url\":\"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png\",\"uploadDate\":\"2019-07-22T09:13:00.000Z\"},{\"@type\":\"ImageObject\",\"url\":\"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png.webp\",\"uploadDate\":\"2019-07-22T09:13:00.000Z\"}]},{\"@context\":\"https://schema.org\",\"@type\":\"BreadcrumbList\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"文章\",\"item\":\"https://blog.skk.moe/archives/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"技术向\",\"item\":\"https://blog.skk.moe/categories/%E6%8A%80%E6%9C%AF%E5%90%91/\"},{\"@type\":\"ListItem\",\"position\":3,\"name\":\"浅谈在代理环境中的 DNS 解析行为\"}]}]"])</script><script>self.__next_f.push([1,"8:[[\"$\",\"div\",null,{\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\",\"$1c\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$1d\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"gSBWlu kooHYa IVbXa foGVKH iMkoWi dQPgRK eKlQYW gCyRDn latiKE sFNbj evdPrE gxEkDX dkWiBb iQmyKI kHUQvx hIa_dhX giuvA ctIwOA dKqzWb gcVpWM \",\"children\":[[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":\"2\",\"className\":\"dcsbFK fWGxWC kOqOXj \",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z\"}],[\"$\",\"path\",null,{\"d\":\"m8 16 6-2 2-6-6 2z\"}]]}],[\"$\",\"div\",null,{\"className\":\"gSBWlu iMkoWi cQQQFz egGyMq \",\"children\":[[\"$\",\"p\",null,{\"className\":\"jfXcDa jxySid hHyHSZ \",\"children\":\"What are you looking for?\"}],[\"$\",\"p\",null,{\"className\":\"cQQQFz kuqFxU fUqtKm eApAOW \",\"children\":\"Maybe this link is broken. Maybe something was deleted, or moved. In any case, there’s nothing to see here.\"}],[\"$\",\"p\",null,{\"className\":\"bqLlHT kuqFxU fUqtKm eApAOW \",\"children\":[\"You can try using \",[\"$\",\"$Le\",null,{\"href\":\"/search/\",\"replace\":false,\"children\":\"search\"}],\" to find the content, or \",[\"$\",\"$Le\",null,{\"href\":\"/\",\"children\":\"back to homepage\"}],\".\"]}]]}]]}],\"notFoundStyles\":[],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d9fb349f3ded94d2.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],\"className\":\"kQBRAp ebjNJd lnHxHM \"}],[\"$\",\"aside\",null,{\"className\":\"kQBRAp jNLCbB lnHxHM bkSasJ eBzqiJ \",\"children\":[\"$L1e\",[\"$\",\"div\",null,{\"className\":\"kiysLX hBBXbq \",\"children\":[[\"$\",\"$L1f\",null,{\"tocIds\":[\"Bu-Shi-Yong-Dai-Li\",\"She-Zhi-Dai-Li-Bing-Shi-Yong-Zhi-Lian\",\"She-Zhi-Dai-Li-Bing-Jiang-Liu-Liang-Zhuan-Fa-Dao-Yuan-Duan-Fu-Wu-Qi\",\"She-Zhi-Dai-Li-Bing-Shi-Yong-IP-Gui-Ze-He-Yu-Ming-Gui-Ze-Jin-Xing-Fen-Liu\",\"Shi-Yong-redir-x2F-tun2socks-Shi-Xian-Quan-Ju-Liu-Liang-Jing-Guo-Dai-Li\",\"Zai-redir-x2F-tun2socks-Zhong-Shi-Yong-Fake-IP\",\"FancySS-He-Surge-x2F-Clash-De-Qu-Bie\",\"Ru-Guo-Cao-Zuo-Xi-Tong-Huo-Zhe-Liu-Lan-Qi-Huan-Cun-Liao-DNS-Jie-Xi-Jie-Guo\",\"Can-Kao-Zi-Liao-2\"],\"children\":[\"$\",\"$L20\",null,{\"children\":[false,[\"$\",\"ul\",\"undefined-children-list\",{\"className\":\"\",\"children\":[[[\"$\",\"li\",\"Bu-Shi-Yong-Dai-Li\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"Bu-Shi-Yong-Dai-Li\",\"text\":\"不使用代理\",\"index\":\"1\"}}]}],false],[[\"$\",\"li\",\"She-Zhi-Dai-Li-Bing-Shi-Yong-Zhi-Lian\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"She-Zhi-Dai-Li-Bing-Shi-Yong-Zhi-Lian\",\"text\":\"设置代理并使用直连\",\"index\":\"2\"}}]}],false],[[\"$\",\"li\",\"She-Zhi-Dai-Li-Bing-Jiang-Liu-Liang-Zhuan-Fa-Dao-Yuan-Duan-Fu-Wu-Qi\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"She-Zhi-Dai-Li-Bing-Jiang-Liu-Liang-Zhuan-Fa-Dao-Yuan-Duan-Fu-Wu-Qi\",\"text\":\"设置代理并将流量转发到远端服务器\",\"index\":\"3\"}}]}],false],[[\"$\",\"li\",\"She-Zhi-Dai-Li-Bing-Shi-Yong-IP-Gui-Ze-He-Yu-Ming-Gui-Ze-Jin-Xing-Fen-Liu\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"She-Zhi-Dai-Li-Bing-Shi-Yong-IP-Gui-Ze-He-Yu-Ming-Gui-Ze-Jin-Xing-Fen-Liu\",\"text\":\"设置代理并使用 IP 规则和域名规则进行分流\",\"index\":\"4\"}}]}],false],[[\"$\",\"li\",\"Shi-Yong-redir-x2F-tun2socks-Shi-Xian-Quan-Ju-Liu-Liang-Jing-Guo-Dai-Li\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"Shi-Yong-redir-x2F-tun2socks-Shi-Xian-Quan-Ju-Liu-Liang-Jing-Guo-Dai-Li\",\"text\":\"使用 redir / tun2socks 实现全局流量经过代理\",\"index\":\"5\"}}]}],false],[[\"$\",\"li\",\"Zai-redir-x2F-tun2socks-Zhong-Shi-Yong-Fake-IP\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"Zai-redir-x2F-tun2socks-Zhong-Shi-Yong-Fake-IP\",\"text\":\"在 redir / tun2socks 中使用 Fake IP\",\"index\":\"6\"}}]}],false],[[\"$\",\"li\",\"FancySS-He-Surge-x2F-Clash-De-Qu-Bie\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"FancySS-He-Surge-x2F-Clash-De-Qu-Bie\",\"text\":\"FancySS 和 Surge / Clash 的区别\",\"index\":\"7\"}}]}],false],[[\"$\",\"li\",\"Ru-Guo-Cao-Zuo-Xi-Tong-Huo-Zhe-Liu-Lan-Qi-Huan-Cun-Liao-DNS-Jie-Xi-Jie-Guo\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"Ru-Guo-Cao-Zuo-Xi-Tong-Huo-Zhe-Liu-Lan-Qi-Huan-Cun-Liao-DNS-Jie-Xi-Jie-Guo\",\"text\":\"如果操作系统或者浏览器缓存了 DNS 解析结果\",\"index\":\"8\"}}]}],false],[[\"$\",\"li\",\"Can-Kao-Zi-Liao-2\",{\"className\":\"jTjNVR iKck hNjeNG bmFLeF \",\"children\":[\"$\",\"$L21\",null,{\"toc\":{\"id\":\"Can-Kao-Zi-Liao-2\",\"text\":\"参考资料\",\"index\":\"9\"}}]}],false]]}]]}]}],[\"$\",\"div\",null,{\"className\":\"kQBRAp bfssAU \",\"children\":[\"$L22\",\"$L23\"]}],[\"$\",\"div\",null,{\"className\":\"\",\"children\":[\"$L24\",\"$L25\"]}]]}]]}],[\"$\",\"aside\",null,{\"className\":\"fcXWHl gGHVHy lnHxHM gmUhDS \",\"children\":[\"$\",\"div\",null,{\"className\":\"evLKHN bCLaAs \",\"children\":[\"$L26\",\"$L27\",false]}]}],[\"$\",\"div\",null,{\"className\":\"imhmwA eSaSrN kYCSJu dgroLK jqaXfP cQYyqP kSWQpF \",\"children\":[[\"$\",\"$L28\",null,{\"children\":[\"$\",\"a\",null,{\"role\":\"button\",\"aria-label\":\"文章目录\",\"children\":[\"$\",\"i\",null,{\"className\":\"cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ cFxYsm julXB dhOkuk kvHVCE hCTuXM cqyuit cOyzyd kSnqYR bQvqKh iqzSxf fqXcHQ haKUHj dyMCpl kevfEr dXSlMo\"}],\"className\":\"foGVKH jcakPO diNRrl edlReQ kQBRAp fYTIfM izjaRz irHqxI ka_DAXd feZCbt egGyMq joyWtj jsvbrX kOZVYa jxdZaJ hacnay huVdIn larHMv jGAsBS fvWVzw cRisAQ eRJcWQ dDzUXW \"}]}],[\"$\",\"a\",null,{\"href\":\"#\",\"title\":\"top\",\"aria-label\":\"回到顶部\",\"children\":[\"$\",\"i\",null,{\"className\":\"cpOcAb hHGIsI jXmXEB dwPPpV cjScYX fygwnR bLHLvQ ecjlX bsEZrB cFxYsm julXB dhOkuk kvHVCE hCTuXM cqyuit iEAnTV kfcRAM kSnqYR fgiDpI eeAUEW gjJuRC iWYpgm jbBqfU fqXcHQ haKUHj dyMCpl kevfEr dXSlMo\"}],\"className\":\"foGVKH jcakPO diNRrl edlReQ kQBRAp fYTIfM izjaRz irHqxI ka_DAXd feZCbt egGyMq joyWtj jsvbrX kOZVYa jxdZaJ hacnay huVdIn larHMv jGAsBS fvWVzw cRisAQ eRJcWQ \"}]]}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"$29\"}}]]\n"])</script><script>self.__next_f.push([1,"14:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1, viewport-fit=cover\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"浅谈在代理环境中的 DNS 解析行为 | Sukka's Blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"虽然 Fake IP 这个概念早在 2001 年就被提出来了，但是到 Clash 提供 fake-ip 增强模式以后，依然有很多人对 Fake IP 这个概念以及其作用知之甚少。本文就简单谈谈在代理环境中，TCP 连接建立之前发生的事。由于移动设备操作系统中网络栈相对复杂，本文的例子也并不一定适用于移动端环境。文章中也许会存在很多错误，也希望各路大佬的勘误和斧正。\"}],[\"$\",\"meta\",\"4\",{\"name\":\"application-name\",\"content\":\"Sukka's Blog\"}],[\"$\",\"link\",\"5\",{\"rel\":\"author\",\"href\":\"https://skk.moe\"}],[\"$\",\"meta\",\"6\",{\"name\":\"author\",\"content\":\"Sukka\"}],[\"$\",\"meta\",\"7\",{\"name\":\"generator\",\"content\":\"Hexo 6.3.0\"}],[\"$\",\"meta\",\"8\",{\"name\":\"keywords\",\"content\":\"技术向,DNS,Surge,Clash,Fake IP,SOCKS5,Sukka,SukkaW,苏卡卡,博客,@SukkaW,Hexo,React,macOS,Web,blog,Front-End,前端开发,Developer,JavaScript\"}],[\"$\",\"meta\",\"9\",{\"name\":\"creator\",\"content\":\"Sukka\"}],[\"$\",\"link\",\"10\",{\"rel\":\"canonical\",\"href\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\"}],[\"$\",\"link\",\"11\",{\"rel\":\"alternate\",\"type\":\"application/atom+xml\",\"title\":\"Sukka's Blog Atom RSS\",\"href\":\"https://blog.skk.moe/atom.xml\"}],[\"$\",\"link\",\"12\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"title\":\"Sukka's Blog RSS 2.0\",\"href\":\"https://blog.skk.moe/rss.xml\"}],[\"$\",\"link\",\"13\",{\"rel\":\"alternate\",\"type\":\"application/feed+json\",\"title\":\"Sukka's Blog JSON Feed\",\"href\":\"https://blog.skk.moe/feed.json\"}],[\"$\",\"meta\",\"14\",{\"name\":\"format-detection\",\"content\":\"telephone=no\"}],[\"$\",\"meta\",\"15\",{\"name\":\"apple-mobile-web-app-capable\",\"content\":\"yes\"}],[\"$\",\"meta\",\"16\",{\"name\":\"apple-mobile-web-app-title\",\"content\":\"Sukka's Blog\"}],[\"$\",\"meta\",\"17\",{\"name\":\"apple-mobile-web-app-status-bar-style\",\"content\":\"black\"}],[\"$\",\"meta\",\"18\",{\"property\":\"og:title\",\"content\":\"浅谈在代理环境中的 DNS 解析行为 | Sukka's Blog\"}],[\"$\",\"meta\",\"19\",{\"property\":\"og:description\",\"content\":\"虽然 Fake IP 这个概念早在 2001 年就被提出来了，但是到 Clash 提供 fake-ip 增强模式以后，依然有很多人对 Fake IP 这个概念以及其作用知之甚少。本文就简单谈谈在代理环境中，TCP 连接建立之前发生的事。由于移动设备操作系统中网络栈相对复杂，本文的例子也并不一定适用于移动端环境。文章中也许会存在很多错误，也希望各路大佬的勘误和斧正。\"}],[\"$\",\"meta\",\"20\",{\"property\":\"og:url\",\"content\":\"https://blog.skk.moe/post/what-happend-to-dns-in-proxy/\"}],[\"$\",\"meta\",\"21\",{\"property\":\"og:site_name\",\"content\":\"Sukka's Blog\"}],[\"$\",\"meta\",\"22\",{\"property\":\"og:locale\",\"content\":\"zh-Hans\"}],[\"$\",\"meta\",\"23\",{\"property\":\"og:image\",\"content\":\"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png\"}],[\"$\",\"meta\",\"24\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"25\",{\"property\":\"article:published_time\",\"content\":\"2019-07-22T09:13:00.000Z\"}],[\"$\",\"meta\",\"26\",{\"property\":\"article:modified_time\",\"content\":\"2019-07-22T09:13:00.000Z\"}],[\"$\",\"meta\",\"27\",{\"property\":\"article:author\",\"content\":\"https://skk.moe\"}],[\"$\",\"meta\",\"28\",{\"property\":\"article:section\",\"content\":\"技术向\"}],[\"$\",\"meta\",\"29\",{\"property\":\"article:tag\",\"content\":\"技术向\"}],[\"$\",\"meta\",\"30\",{\"property\":\"article:tag\",\"content\":\"DNS\"}],[\"$\",\"meta\",\"31\",{\"property\":\"article:tag\",\"content\":\"Surge\"}],[\"$\",\"meta\",\"32\",{\"property\":\"article:tag\",\"content\":\"Clash\"}],[\"$\",\"meta\",\"33\",{\"property\":\"article:tag\",\"content\":\"Fake IP\"}],[\"$\",\"meta\",\"34\",{\"property\":\"article:tag\",\"content\":\"SOCKS5\"}],[\"$\",\"meta\",\"35\",{\"property\":\"article:tag\",\"content\":\"Sukka\"}],[\"$\",\"meta\",\"36\",{\"property\":\"article:tag\",\"content\":\"SukkaW\"}],[\"$\",\"meta\",\"37\",{\"property\":\"article:tag\",\"content\":\"苏卡卡\"}],[\"$\",\"meta\",\"38\",{\"property\":\"article:tag\",\"content\":\"博客\"}],[\"$\",\"meta\",\"39\",{\"property\":\"article:tag\",\"content\":\"@SukkaW\"}],[\"$\",\"meta\",\"40\",{\"property\":\"article:tag\",\"content\":\"Hexo\"}],[\"$\",\"meta\",\"41\",{\"property\":\"article:tag\",\"content\":\"React\"}],[\"$\",\"meta\",\"42\",{\"property\":\"article:tag\",\"content\":\"macOS\"}],[\"$\",\"meta\",\"43\",{\"property\":\"article:tag\",\"content\":\"Web\"}],[\"$\",\"meta\",\"44\",{\"property\":\"article:tag\",\"content\":\"blog\"}],[\"$\",\"meta\",\"45\",{\"property\":\"article:tag\",\"content\":\"Front-End\"}],[\"$\",\"meta\",\"46\",{\"property\":\"article:tag\",\"content\":\"前端开发\"}],[\"$\",\"meta\",\"47\",{\"property\":\"article:tag\",\"content\":\"Developer\"}],[\"$\",\"meta\",\"48\",{\"property\":\"article:tag\",\"content\":\"JavaScript\"}],[\"$\",\"meta\",\"49\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"50\",{\"name\":\"twitter:site\",\"content\":\"@isukkaw\"}],[\"$\",\"meta\",\"51\",{\"name\":\"twitter:creator\",\"content\":\"@isukkaw\"}],[\"$\",\"meta\",\"52\",{\"name\":\"twitter:title\",\"content\":\"浅谈在代理环境中的 DNS 解析行为 | Sukka's Blog\"}],[\"$\",\"meta\",\"53\",{\"name\":\"twitter:description\",\"content\":\"虽然 Fake IP 这个概念早在 2001 年就被提出来了，但是到 Clash 提供 fake-ip 增强模式以后，依然有很多人对 Fake IP 这个概念以及其作用知之甚少。本文就简单谈谈在代理环境中，TCP 连接建立之前发生的事。由于移动设备操作系统中网络栈相对复杂，本文的例子也并不一定适用于移动端环境。文章中也许会存在很多错误，也希望各路大佬的勘误和斧正。\"}],[\"$\",\"meta\",\"54\",{\"name\":\"twitter:image\",\"content\":\"https://img10.360buyimg.com/ddimg/jfs/t1/135552/15/25291/68779/622032b6E4859ebc2/949482016254a155.png\"}],[\"$\",\"link\",\"55\",{\"rel\":\"icon\",\"href\":\"https://cdn.skk.moe/favicon.ico\",\"type\":\"image/ico\",\"sizes\":\"any\"}],[\"$\",\"link\",\"56\",{\"rel\":\"icon\",\"href\":\"https://cdn.skk.moe/avatar/sketch-rounded.svg\",\"type\":\"image/svg+xml\"}],[\"$\",\"link\",\"57\",{\"rel\":\"icon\",\"href\":\"https://img10.360buyimg.com/ddimg/jfs/t1/214763/35/13698/9649/62203a97Ef7d7453e/84a292101971af7f.png\",\"type\":\"image/png\",\"sizes\":\"192x192\"}],[\"$\",\"link\",\"58\",{\"rel\":\"apple-touch-icon\",\"href\":\"https://img10.360buyimg.com/ddimg/jfs/t1/211800/6/13892/3415/62203a77E1e0336e1/3ff60a045944c288.png\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script><script>self.__next_f.push([1,"22:[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN\",\"children\":[[\"$\",\"div\",null,{\"className\":\"epEjwu diNRrl bBVwIW hyjQvk \",\"children\":\"相关文章\"}],[[\"$\",\"div\",null,{\"className\":\"kKplrA \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2019-08-02\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/how-koolclash-worked/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"KoolClash 的工作机制\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2018-08-25\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/aliyun-vipdns-anycast/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"阿里云 BGP Anycast 路由\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2019-05-09\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/macos-vmware-surge-gateway/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"使用 VMware 安装 macOS 虚拟机使用 Surge 作为代理网关\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2018-09-08\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/about-cname-and-mx-conflicts/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"也来谈谈关于 CNAME 和 MX 冲突的一些事\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2019-05-13\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/alternate-surge-koolclash-as-gateway/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"代替 Surge 增强模式——使用 KoolClash 作为代理网关\"}]]}]]]}]\n"])</script><script>self.__next_f.push([1,"26:[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN\",\"children\":[[\"$\",\"div\",null,{\"className\":\"epEjwu diNRrl bBVwIW hyjQvk \",\"children\":\"相关文章\"}],[[\"$\",\"div\",null,{\"className\":\"kKplrA \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2019-08-02\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/how-koolclash-worked/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"KoolClash 的工作机制\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2018-08-25\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/aliyun-vipdns-anycast/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"阿里云 BGP Anycast 路由\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2019-05-09\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/macos-vmware-surge-gateway/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"使用 VMware 安装 macOS 虚拟机使用 Surge 作为代理网关\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2018-09-08\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/about-cname-and-mx-conflicts/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"也来谈谈关于 CNAME 和 MX 冲突的一些事\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2019-05-13\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/alternate-surge-koolclash-as-gateway/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"代替 Surge 增强模式——使用 KoolClash 作为代理网关\"}]]}]]]}]\n"])</script><script>self.__next_f.push([1,"23:[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN\",\"children\":[[\"$\",\"div\",null,{\"className\":\"epEjwu diNRrl bBVwIW hyjQvk \",\"children\":\"最近文章\"}],[[\"$\",\"div\",null,{\"className\":\"kKplrA \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2024-01-04\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/2023-browser-from-a-to-z/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"2023：浏览器从 A 到 Z\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2023-06-25\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/refactor-my-blog-using-nextjs-app-router/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"React Server Component 初体验与实践 —— 将博客迁移到 Next.js App Router\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2023-01-15\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/say-no-to-meta-keywords/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"Meta Keywords：是什么、为什么不\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2023-01-12\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/2022-browser-from-a-to-z/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"2022：浏览器从 A 到 Z\"}]]}]]]}]\n"])</script><script>self.__next_f.push([1,"27:[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN\",\"children\":[[\"$\",\"div\",null,{\"className\":\"epEjwu diNRrl bBVwIW hyjQvk \",\"children\":\"最近文章\"}],[[\"$\",\"div\",null,{\"className\":\"kKplrA \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2024-01-04\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/2023-browser-from-a-to-z/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"2023：浏览器从 A 到 Z\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2023-06-25\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/refactor-my-blog-using-nextjs-app-router/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"React Server Component 初体验与实践 —— 将博客迁移到 Next.js App Router\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2023-01-15\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/say-no-to-meta-keywords/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"Meta Keywords：是什么、为什么不\"}]]}],[\"$\",\"div\",null,{\"className\":\"kKplrA izykGz FwRrA hTgzNw ifowTF gdCONY \",\"children\":[[\"$\",\"time\",null,{\"className\":\"diNRrl \",\"children\":\"2023-01-12\"}],[\"$\",\"br\",null,{}],[\"$\",\"$Le\",null,{\"href\":\"/post/2022-browser-from-a-to-z/\",\"prefetch\":false,\"className\":\"kKRHCo jfXcDa kiMAEz kuqFxU bbUXPo eOUwza bGTDx kGbpDY \",\"children\":\"2022：浏览器从 A 到 Z\"}]]}]]]}]\n"])</script><script>self.__next_f.push([1,"24:[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN\",\"children\":[[\"$\",\"div\",null,{\"className\":\"epEjwu diNRrl bBVwIW hyjQvk \",\"children\":\"分类\"}],[[\"$\",\"$Le\",null,{\"href\":\"/categories/%E6%8A%80%E6%9C%AF%E5%90%91/\",\"prefetch\":false,\"children\":[\"技术向\",[\"$\",\"span\",null,{\"className\":\"dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf \",\"children\":35}]],\"className\":\"joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN\"}],[\"$\",\"$Le\",null,{\"href\":\"/categories/%E7%AC%94%E8%AE%B0%E6%9C%AC/\",\"prefetch\":false,\"children\":[\"笔记本\",[\"$\",\"span\",null,{\"className\":\"dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf \",\"children\":33}]],\"className\":\"joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN\"}],[\"$\",\"$Le\",null,{\"href\":\"/categories/%E5%88%9B%E4%BD%9C%E9%9B%86/\",\"prefetch\":false,\"children\":[\"创作集\",[\"$\",\"span\",null,{\"className\":\"dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf \",\"children\":9}]],\"className\":\"joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN\"}],[\"$\",\"$Le\",null,{\"href\":\"/categories/%E8%87%AA%E8%A8%80%E8%AF%AD/\",\"prefetch\":false,\"children\":[\"自言语\",[\"$\",\"span\",null,{\"className\":\"dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf \",\"children\":10}]],\"className\":\"joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN\"}],[\"$\",\"$Le\",null,{\"href\":\"/categories/%E5%88%86%E4%BA%AB%E5%A2%83/\",\"prefetch\":false,\"children\":[\"分享境\",[\"$\",\"span\",null,{\"className\":\"dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf \",\"children\":3}]],\"className\":\"joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN\"}],[\"$\",\"$Le\",null,{\"href\":\"/categories/%E9%BB%91%E8%8B%B9%E6%9E%9C/\",\"prefetch\":false,\"children\":[\"黑苹果\",[\"$\",\"span\",null,{\"className\":\"dPVLzs kuqFxU dqDJrk kPYxJl hEBnfg bXeeuD hUIbWH kgTdNZ itAGJL hFSzir bmPsOO engKkf \",\"children\":10}]],\"className\":\"joyWtj gSBWlu kcJmwb itAGJL HhHXE bmPsOO bTNDYw kKRHCo kJzccJ kKtmxt hvlmEN\"}]]]}]\n"])</script><script>self.__next_f.push([1,"25:[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN\",\"children\":[[\"$\",\"div\",null,{\"className\":\"epEjwu diNRrl bBVwIW hyjQvk \",\"children\":\"热门标签\"}],[\"$\",\"div\",null,{\"className\":\"gSBWlu kiDYix fPWmiY ipqqbv \",\"children\":[[\"$\",\"$Le\",\"/tags/macOS/\",{\"href\":\"/tags/macOS/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"macOS\"]}]}],[\"$\",\"$Le\",\"/tags/JavaScript/\",{\"href\":\"/tags/JavaScript/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"JavaScript\"]}]}],[\"$\",\"$Le\",\"/tags/DNS/\",{\"href\":\"/tags/DNS/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"DNS\"]}]}],[\"$\",\"$Le\",\"/tags/Hexo/\",{\"href\":\"/tags/Hexo/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"Hexo\"]}]}],[\"$\",\"$Le\",\"/tags/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/\",{\"href\":\"/tags/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"前端性能优化\"]}]}],[\"$\",\"$Le\",\"/tags/Hackintosh/\",{\"href\":\"/tags/Hackintosh/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"Hackintosh\"]}]}],[\"$\",\"$Le\",\"/tags/CDN/\",{\"href\":\"/tags/CDN/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"CDN\"]}]}],[\"$\",\"$Le\",\"/tags/OpenWrt/\",{\"href\":\"/tags/OpenWrt/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"OpenWrt\"]}]}],[\"$\",\"$Le\",\"/tags/Cloudflare/\",{\"href\":\"/tags/Cloudflare/\",\"prefetch\":false,\"className\":\"kKRHCo kTFJNM fkxGrD epcuwU dlOsbI huhiQk \",\"children\":[\"$\",\"span\",null,{\"className\":\"hNyMbp iANrEZ eOUwza bGTDx kGbpDY \",\"children\":[\"# \",\"Cloudflare\"]}]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1e:[\"$\",\"div\",null,{\"className\":\"dvivnl llUCyD hsxujn izjaRz irHqxI ka_DAXd feZCbt iZcyKt jXUIWe kWUGWQ diLtXU gxEkDX cTVtxN kooHYa\",\"children\":[\"$undefined\",[[\"$\",\"div\",null,{\"className\":\"jIJzLC eYbNXG jTjNVR jdraHW hyjQvk eqrBPF clJfeA kimLBn iHrpsk fPwJri \",\"children\":[\"$\",\"picture\",null,{\"children\":[[\"$\",\"source\",null,{\"type\":\"image/webp\",\"srcSet\":\"https://img10.360buyimg.com/ddimg/jfs/t1/214940/28/13992/13695/622039e0E8283ea56/6176b9c35f4d60ab.webp\"}],[\"$\",\"img\",null,{\"className\":\"jIJzLC eYbNXG clJfeA kimLBn iHrpsk fPwJri \",\"width\":\"96\",\"height\":\"96\",\"alt\":\"Sukka's Avatar\",\"src\":\"https://img10.360buyimg.com/ddimg/jfs/t1/214940/28/13992/13695/622039e0E8283ea56/6176b9c35f4d60ab.png\",\"decoding\":\"async\",\"loading\":\"lazy\"}]]}]}],[\"$\",\"h2\",null,{\"children\":\"Sukka\",\"className\":\"kiMAEz buowod rXoKk dIAaBe hyjQvk ctpWtp\"}],[\"$\",\"div\",null,{\"className\":\"hyjQvk \",\"children\":\"童话只美在真实却从不续写\"}],[\"$\",\"a\",null,{\"className\":\"fcXWHl \",\"rel\":\"me\",\"href\":\"https://acg.mn/@sukka\"}],[\"$\",\"div\",null,{\"className\":\"gSBWlu kJzccJ \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jTjNVR gPtJog hNjeNG PSfXk dQPgRK bUPwGt iBlkxz \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jfXcDa dIAaBe \",\"children\":\"101\"}],[\"$\",\"div\",null,{\"className\":\"jfXcDa kKRHCo \",\"children\":\"文章\"}]]}],[\"$\",\"div\",null,{\"className\":\"jTjNVR gPtJog hNjeNG PSfXk dQPgRK bUPwGt iBlkxz \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jfXcDa dIAaBe \",\"children\":6}],[\"$\",\"div\",null,{\"className\":\"jfXcDa kKRHCo \",\"children\":\"分类\"}]]}],[\"$\",\"div\",null,{\"className\":\"jTjNVR gPtJog hNjeNG PSfXk dQPgRK bUPwGt iBlkxz \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jfXcDa dIAaBe \",\"children\":186}],[\"$\",\"div\",null,{\"className\":\"jfXcDa kKRHCo \",\"children\":\"标签\"}]]}],[\"$\",\"div\",null,{\"className\":\"jTjNVR gPtJog hNjeNG PSfXk dQPgRK bUPwGt iBlkxz \",\"children\":[[\"$\",\"div\",null,{\"className\":\"jfXcDa dIAaBe \",\"children\":\"29.5\"}],[\"$\",\"div\",null,{\"className\":\"jfXcDa kKRHCo \",\"children\":\"万字\"}]]}]]}]]]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html> 
     </body> 
 </html> 
